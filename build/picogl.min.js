!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PicoGL=t()}}(function(){return function t(e,i,r){function s(h,a){if(!i[h]){if(!e[h]){var o="function"==typeof require&&require;if(!a&&o)return o(h,!0);if(n)return n(h,!0);var u=new Error("Cannot find module '"+h+"'");throw u.code="MODULE_NOT_FOUND",u}var _=i[h]={exports:{}};e[h][0].call(_.exports,function(t){var i=e[h][1][t];return s(i||t)},_,_.exports,t,e,i,r)}return i[h].exports}for(var n="function"==typeof require&&require,h=0;h<r.length;h++)s(r[h]);return s}({1:[function(t,e,i){"use strict";var r=t("./cubemap"),s=t("./drawcall"),n=t("./framebuffer"),h=t("./picogl"),a=t("./program"),o=t("./shader"),u=t("./texture"),_=t("./timer"),E=t("./transformfeedback"),l=t("./uniformbuffer"),T=t("./vertexarray"),f=t("./vertexbuffer"),N=function(t,e){this.canvas=t,this.gl=t.getContext("webgl2",e),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewportWidth=this.width,this.viewportHeight=this.height,this.currentDrawCalls=null,this.emptyFragmentShader=null,this.state={program:null,vertexArray:null,transformFeedback:null,activeTexture:-1,textures:new Array(h.WEBGL_INFO.MAX_TEXTURE_UNITS),textureCount:0,freeTextureUnits:[],uniformBuffers:new Array(h.WEBGL_INFO.MAX_UNIFORM_BUFFERS),uniformBufferCount:0,freeUniformBufferBases:[],drawFramebuffer:null,readFramebuffer:null},this.clearBits=this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT,this.timer=new _(this.gl),this.cpuTime=0,this.gpuTime=0,this.floatRenderTargetsEnabled=!1,this.linearFloatTexturesEnabled=!1,this.gl.viewport(0,0,this.viewportWidth,this.viewportHeight)};N.prototype.colorMask=function(t,e,i,r){return this.gl.colorMask(t,e,i,r),this},N.prototype.clearColor=function(t,e,i,r){return this.gl.clearColor(t,e,i,r),this},N.prototype.clearMask=function(t){return this.clearBits=t,this},N.prototype.clear=function(){return this.gl.clear(this.clearBits),this},N.prototype.drawCalls=function(t){return this.currentDrawCalls=t,this},N.prototype.drawFramebuffer=function(t){return t.bindForDraw(),this.viewportWidth===t.width&&this.viewportHeight===t.height||(this.viewportWidth=t.width,this.viewportHeight=t.height,this.gl.viewport(0,0,this.viewportWidth,this.viewportHeight)),this},N.prototype.readFramebuffer=function(t){return t.bindForRead(),this},N.prototype.defaultDrawFramebuffer=function(){return null!==this.state.drawFramebuffer&&(this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,null),this.state.drawFramebuffer=null,this.viewportWidth===this.width&&this.viewportHeight===this.height||(this.viewportWidth=this.width,this.viewportHeight=this.height,this.gl.viewport(0,0,this.viewportWidth,this.viewportHeight))),this},N.prototype.defaultReadFramebuffer=function(){return null!==this.state.readFramebuffer&&(this.gl.bindFramebuffer(this.gl.READ_FRAMEBUFFER,null),this.state.readFramebuffer=null),this},N.prototype.depthRange=function(t,e){return this.gl.depthRange(t,e),this},N.prototype.depthTest=function(){return this.gl.enable(this.gl.DEPTH_TEST),this},N.prototype.noDepthTest=function(){return this.gl.disable(this.gl.DEPTH_TEST),this},N.prototype.depthMask=function(){return this.gl.depthMask(!0),this},N.prototype.noDepthMask=function(){return this.gl.depthMask(!1),this},N.prototype.depthFunc=function(t){return this.gl.depthFunc(t),this},N.prototype.blend=function(){return this.gl.enable(this.gl.BLEND),this},N.prototype.noBlend=function(){return this.gl.disable(this.gl.BLEND),this},N.prototype.blendFunc=function(t,e){return this.gl.blendFunc(t,e),this},N.prototype.blendFuncSeparate=function(t,e,i,r){return this.gl.blendFuncSeparate(t,e,i,r),this},N.prototype.stencilTest=function(){return this.gl.enable(this.gl.STENCIL_TEST),this},N.prototype.noStencilTest=function(){return this.gl.disable(this.gl.STENCIL_TEST),this},N.prototype.stencilMask=function(t){return this.gl.stencilMask(t),this},N.prototype.stencilMaskSeparate=function(t,e){return this.gl.stencilMaskSeparate(t,e),this},N.prototype.stencilFunc=function(t,e,i){return this.gl.stencilFunc(t,e,i),this},N.prototype.stencilFuncSeparate=function(t,e,i,r){return this.gl.stencilFuncSeparate(t,e,i,r),this},N.prototype.stencilOp=function(t,e,i){return this.gl.stencilOp(t,e,i),this},N.prototype.stencilOpSeparate=function(t,e,i,r){return this.gl.stencilOpSeparate(t,e,i,r),this},N.prototype.rasterize=function(){return this.gl.disable(this.gl.RASTERIZER_DISCARD),this},N.prototype.noRasterize=function(){return this.gl.enable(this.gl.RASTERIZER_DISCARD),this},N.prototype.cullBackfaces=function(){return this.gl.enable(this.gl.CULL_FACE),this},N.prototype.drawBackfaces=function(){return this.gl.disable(this.gl.CULL_FACE),this},N.prototype.floatRenderTargets=function(){return this.floatRenderTargetsEnabled=!!this.gl.getExtension("EXT_color_buffer_float"),this.floatRenderTargetsEnabled||console.warn("Extension EXT_color_buffer_float unavailable. Cannot enable float textures."),this},N.prototype.linearFloatTextures=function(){return this.linearFloatTexturesEnabled=!!this.gl.getExtension("OES_texture_float_linear"),this.linearFloatTexturesEnabled||console.warn("Extension OES_texture_float_linear unavailable. Cannot enable float texture linear filtering."),this},N.prototype.readPixel=function(t,e,i){return this.gl.readPixels(t,e,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),this},N.prototype.resize=function(t,e){return this.canvas.width=t,this.canvas.height=e,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewportWidth=this.width,this.viewportHeight=this.height,this.gl.viewport(0,0,this.viewportWidth,this.viewportHeight),this},N.prototype.createProgram=function(t,e,i){return new a(this.gl,t,e,i)},N.prototype.createShader=function(t,e){return new o(this.gl,t,e)},N.prototype.createVertexArray=function(){return new T(this.gl)},N.prototype.createTransformFeedback=function(){return new E(this.gl)},N.prototype.createVertexBuffer=function(t,e,i,r){return new f(this.gl,t,e,i,r)},N.prototype.createMatrixBuffer=function(t,e,i){return new f(this.gl,t,null,e,i)},N.prototype.createIndexBuffer=function(t,e,i){return new f(this.gl,t,e,i,null,!0)},N.prototype.createUniformBuffer=function(t,e){return new l(this.gl,t,e)},N.prototype.createTexture2D=function(t,e,i,r){return void 0===i&&(r=e,e=t.width,i=t.height),new u(this.gl,this.state,this.gl.TEXTURE_2D,t,e,i,null,!1,r)},N.prototype.createTextureArray=function(t,e,i,r,s){return new u(this.gl,this.state,this.gl.TEXTURE_2D_ARRAY,t,e,i,r,!0,s)},N.prototype.createTexture3D=function(t,e,i,r,s){return new u(this.gl,this.state,this.gl.TEXTURE_3D,t,e,i,r,!0,s)},N.prototype.createCubemap=function(t){return new r(this.gl,this.state,t)},N.prototype.createFramebuffer=function(t,e){return new n(this.gl,this.state,t,e)},N.prototype.createDrawCall=function(t,e,i){return new s(this.gl,t,e,i)},N.prototype.draw=function(){for(var t=0,e=this.currentDrawCalls.length;t<e;t++)this.currentDrawCalls[t].draw(this.state);return this},N.prototype.timerStart=function(){return this.timer.start(),this},N.prototype.timerEnd=function(){return this.timer.end(),this},N.prototype.timerReady=function(){return!!this.timer.ready()&&(this.cpuTime=this.timer.cpuTime,this.gpuTime=this.timer.gpuTime,!0)},e.exports=N},{"./cubemap":2,"./drawcall":3,"./framebuffer":4,"./picogl":6,"./program":7,"./shader":8,"./texture":9,"./timer":10,"./transformfeedback":11,"./uniformbuffer":12,"./vertexarray":14,"./vertexbuffer":15}],2:[function(t,e,i){"use strict";var r=t("./picogl"),s=function(t,e,i){i=i||r.DUMMY_OBJECT,this.gl=t,this.texture=t.createTexture(),this.format=void 0!==i.format?i.format:t.RGBA,this.type=void 0!==i.type?i.type:t.UNSIGNED_BYTE,this.internalFormat=void 0!==i.internalFormat?i.internalFormat:r.TEXTURE_INTERNAL_FORMAT[this.type][this.format],this.appState=e,e.freeTextureUnits.length>0?this.unit=e.freeTextureUnits.pop():(this.unit=e.textureCount%(e.textures.length-1),this.unit+=1,++e.textureCount),this.unitEnum=t.TEXTURE0+this.unit;var s=i.negX,n=i.posX,h=i.negY,a=i.posY,o=i.negZ,u=i.posZ,_=i.width||s.width,E=i.height||s.height,l=void 0!==i.flipY&&i.flipY,T=void 0!==i.minFilter?i.minFilter:t.LINEAR_MIPMAP_NEAREST,f=void 0!==i.magFilter?i.magFilter:t.LINEAR,N=void 0!==i.compareMode?i.compareMode:t.NONE,A=void 0!==i.compareFunc?i.compareFunc:t.LEQUAL,p=!1!==i.generateMipmaps&&(T===t.LINEAR_MIPMAP_NEAREST||T===t.LINEAR_MIPMAP_LINEAR);this.bind(),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,l),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,f),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,T),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_COMPARE_FUNC,A),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_COMPARE_MODE,N),void 0!==i.baseLevel&&t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_BASE_LEVEL,i.baseLevel),void 0!==i.maxLevel&&t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAX_LEVEL,i.maxLevel),void 0!==i.minLOD&&t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_LOD,i.minLOD),void 0!==i.maxLOD&&t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAX_LOD,i.maxLOD);var c=p?Math.floor(Math.log2(Math.min(_,E)))+1:1;t.texStorage2D(t.TEXTURE_CUBE_MAP,c,this.internalFormat,_,E),t.texSubImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,0,0,_,E,this.format,this.type,s),t.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X,0,0,0,_,E,this.format,this.type,n),t.texSubImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,0,0,_,E,this.format,this.type,h),t.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,0,0,_,E,this.format,this.type,a),t.texSubImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,0,0,_,E,this.format,this.type,o),t.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,0,0,_,E,this.format,this.type,u),p&&t.generateMipmap(t.TEXTURE_CUBE_MAP)};s.prototype.delete=function(){this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.appState.freeTextureUnits.push(this.unit),this.appState.textures[this.unit]=null,this.unit=-1,this.unitEnum=-1)},s.prototype.bind=function(){return this.appState.activeTexture!==this.unit&&(this.gl.activeTexture(this.unitEnum),this.appState.activeTexture=this.unit),this.appState.textures[this.unit]!==this&&(this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.texture),this.appState.textures[this.unit]=this),this},e.exports=s},{"./picogl":6}],3:[function(t,e,i){"use strict";var r=t("./picogl"),s=function(t,e,i,s){this.gl=t,this.currentProgram=e,this.currentVertexArray=i,this.currentTransformFeedback=null,this.uniformIndices={},this.uniformNames=new Array(r.WEBGL_INFO.MAX_UNIFORMS),this.uniformValues=new Array(r.WEBGL_INFO.MAX_UNIFORMS),this.uniformCount=0,this.uniformBuffers=new Array(r.WEBGL_INFO.MAX_UNIFORM_BUFFERS),this.uniformBlockNames=new Array(r.WEBGL_INFO.MAX_UNIFORM_BUFFERS),this.uniformBlockBases={},this.uniformBlockCount=0,this.samplerIndices={},this.textures=new Array(r.WEBGL_INFO.MAX_TEXTURE_UNITS),this.textureCount=0,this.primitive=void 0!==s?s:r.TRIANGLES};s.prototype.transformFeedback=function(t){return this.currentTransformFeedback=t,this},s.prototype.uniform=function(t,e){var i=this.uniformIndices[t];return void 0===i&&(i=this.uniformCount++,this.uniformIndices[t]=i,this.uniformNames[i]=t),this.uniformValues[i]=e,this},s.prototype.texture=function(t,e){var i=this.samplerIndices[t];return void 0===i&&(i=this.textureCount++,this.samplerIndices[t]=i),this.uniform(t,e.unit),this.textures[i]=e,this},s.prototype.uniformBlock=function(t,e){var i=this.uniformBlockBases[t];return void 0===i&&(i=this.uniformBlockCount++,this.uniformBlockBases[t]=i,this.uniformBlockNames[i]=t),this.uniformBuffers[i]=e,this},s.prototype.draw=function(t){var e=this.uniformNames,i=this.uniformValues,r=this.uniformBuffers,s=this.uniformBlockNames,n=this.textures;t.program!==this.currentProgram&&(this.gl.useProgram(this.currentProgram.program),t.program=this.currentProgram);for(var h=0;h<this.uniformCount;++h)this.currentProgram.uniform(e[h],i[h]);for(var a=0;a<this.uniformBlockCount;++a)this.currentProgram.uniformBlock(s[a],a),r[a].bind(a);for(var o=0;o<this.textureCount;++o)n[o].bind();if(t.vertexArray!==this.currentVertexArray&&(this.currentVertexArray.bind(),t.vertexArray=this.currentVertexArray),this.currentTransformFeedback&&(t.transformFeedback!==this.currentTransformFeedback&&this.currentTransformFeedback.bind(),this.gl.beginTransformFeedback(this.primitive)),this.currentVertexArray.instanced?this.currentVertexArray.indexed?this.gl.drawElementsInstanced(this.primitive,this.currentVertexArray.numElements,this.currentVertexArray.indexType,0,this.currentVertexArray.numInstances):this.gl.drawArraysInstanced(this.primitive,0,this.currentVertexArray.numElements,this.currentVertexArray.numInstances):this.currentVertexArray.indexed?this.gl.drawElements(this.primitive,this.currentVertexArray.numElements,this.currentVertexArray.indexType,0):this.gl.drawArrays(this.primitive,0,this.currentVertexArray.numElements),this.currentTransformFeedback){this.gl.endTransformFeedback();for(var u=0,_=this.currentTransformFeedback.angleBugBuffers.length;u<_;++u)this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,u,null)}},e.exports=s},{"./picogl":6}],4:[function(t,e,i){"use strict";var r=t("./picogl"),s=t("./texture"),n=function(t,e,i,r){this.gl=t,this.framebuffer=t.createFramebuffer(),this.appState=e,i&&r?(this.width=i,this.height=r):(this.width=t.drawingBufferWidth,this.height=t.drawingBufferHeight),this.numColorTargets=0,this.colorTextures=[],this.colorAttachments=[],this.depthTexture=null};n.prototype.colorTarget=function(t,e){t=t||0,(e=e||{}).type=e.type||this.gl.UNSIGNED_BYTE,e.format=e.format||this.gl.RGBA,e.internalFormat=e.internalFormat||r.TEXTURE_INTERNAL_FORMAT[e.type][e.format],e.minFilter=e.minFilter||this.gl.NEAREST,e.magFilter=e.magFilter||this.gl.NEAREST,e.wrapS=e.wrapS||this.gl.CLAMP_TO_EDGE,e.wrapT=e.wrapT||this.gl.CLAMP_TO_EDGE,e.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.colorAttachments[t]=this.gl.COLOR_ATTACHMENT0+t;var i=this.bindAndCaptureState();return this.colorTextures[t]=new s(this.gl,this.appState,this.gl.TEXTURE_2D,null,this.width,this.height,null,!1,e),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.colorAttachments[t],this.gl.TEXTURE_2D,this.colorTextures[t].texture,0),this.gl.drawBuffers(this.colorAttachments),this.numColorTargets++,this.restoreState(i),this},n.prototype.depthTarget=function(t){(t=t||{}).format=this.gl.DEPTH_COMPONENT,t.type=t.type||this.gl.UNSIGNED_SHORT,t.internalFormat=t.internalFormat||r.TEXTURE_INTERNAL_FORMAT[t.type][t.format],t.minFilter=t.minFilter||this.gl.NEAREST,t.magFilter=t.magFilter||this.gl.NEAREST,t.wrapS=t.wrapS||this.gl.CLAMP_TO_EDGE,t.wrapT=t.wrapT||this.gl.CLAMP_TO_EDGE,t.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps;var e=this.bindAndCaptureState();return this.depthTexture=new s(this.gl,this.appState,this.gl.TEXTURE_2D,null,this.width,this.height,null,!1,t),this.gl.framebufferTexture2D(this.gl.DRAW_FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0),this.restoreState(e),this},n.prototype.replaceTexture=function(t,e){this.colorTextures[t]=e;var i=this.bindAndCaptureState();return this.gl.framebufferTexture2D(this.gl.DRAW_FRAMEBUFFER,this.colorAttachments[t],this.gl.TEXTURE_2D,this.colorTextures[t].texture,0),this.restoreState(i),this},n.prototype.resize=function(t,e){t&&e?(this.width=t,this.height=e):(this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight);for(var i=this.bindAndCaptureState(),r=0;r<this.numColorTargets;++r)this.colorTextures[r].image(null,this.width,this.height),this.gl.framebufferTexture2D(this.gl.DRAW_FRAMEBUFFER,this.colorAttachments[r],this.gl.TEXTURE_2D,this.colorTextures[r].texture,0);return this.depthTexture&&(this.depthTexture.image(null,this.width,this.height),this.gl.framebufferTexture2D(this.gl.DRAW_FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)),this.restoreState(i),this},n.prototype.delete=function(){for(var t=0;t<this.numColorTargets;++t)this.colorTextures[t].delete();this.depthTexture&&this.depthTexture.delete(),this.framebuffer&&(this.gl.deleteFramebuffer(this.framebuffer),this.framebuffer=null)},n.prototype.bindForDraw=function(){this.appState.drawFramebuffer!==this&&(this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,this.framebuffer),this.appState.drawFramebuffer=this)},n.prototype.bindForRead=function(){this.appState.readFramebuffer!==this&&(this.gl.bindFramebuffer(this.gl.READ_FRAMEBUFFER,this.framebuffer),this.appState.readFramebuffer=this)},n.prototype.bindAndCaptureState=function(){var t=this.appState.drawFramebuffer;return t!==this&&this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,this.framebuffer),t},n.prototype.restoreState=function(t){t!==this&&this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,t?t.framebuffer:null)},e.exports=n},{"./picogl":6,"./texture":9}],5:[function(t,e,i){(function(i){"use strict";var r=t("./app"),s=t("./picogl");i.PicoGL=s,s.version="<%= VERSION %>",s.App=r,s.Program=t("./program"),s.Texture=t("./texture"),s.Cubemap=t("./cubemap"),s.DrawCall=t("./drawcall"),s.Framebuffer=t("./framebuffer"),s.Shader=t("./shader"),s.Timer=t("./timer"),s.TransformFeedback=t("./transformfeedback"),s.UniformBuffer=t("./uniformbuffer"),s.VertexArray=t("./vertexarray"),s.VertexBuffer=t("./vertexbuffer"),s.createApp=function(t,e){return new r(t,e)},e.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./app":1,"./cubemap":2,"./drawcall":3,"./framebuffer":4,"./picogl":6,"./program":7,"./shader":8,"./texture":9,"./timer":10,"./transformfeedback":11,"./uniformbuffer":12,"./vertexarray":14,"./vertexbuffer":15}],6:[function(t,e,i){"use strict";var r={},s=document.createElement("canvas").getContext("webgl2");if(s)for(var n in s)n.match(/^[A-Z0-9_x]+$/)&&"number"==typeof s[n]&&(r[n]=s[n]);r.TEXTURE_INTERNAL_FORMAT={};var h=r.TEXTURE_INTERNAL_FORMAT[s.UNSIGNED_BYTE]={};h[s.RED]=s.R8,h[s.RG]=s.RG8,h[s.RGB]=s.RGB8,h[s.RGBA]=s.RGBA8,(r.TEXTURE_INTERNAL_FORMAT[s.UNSIGNED_SHORT]={})[s.DEPTH_COMPONENT]=s.DEPTH_COMPONENT16;var a=r.TEXTURE_INTERNAL_FORMAT[s.FLOAT]={};a[s.RED]=s.R16F,a[s.RG]=s.RG16F,a[s.RGB]=s.RGB16F,a[s.RGBA]=s.RGBA16F,a[s.DEPTH_COMPONENT]=s.DEPTH_COMPONENT32F,r.TYPE_SIZE={},r.TYPE_SIZE[s.BYTE]=1,r.TYPE_SIZE[s.UNSIGNED_BYTE]=1,r.TYPE_SIZE[s.SHORT]=2,r.TYPE_SIZE[s.UNSIGNED_SHORT]=2,r.TYPE_SIZE[s.INT]=4,r.TYPE_SIZE[s.UNSIGNED_INT]=4,r.TYPE_SIZE[s.FLOAT]=4,r.UNIFORM_FUNC_NAME={},r.UNIFORM_FUNC_NAME[s.BOOL]="uniform1i",r.UNIFORM_FUNC_NAME[s.INT]="uniform1i",r.UNIFORM_FUNC_NAME[s.SAMPLER_2D]="uniform1i",r.UNIFORM_FUNC_NAME[s.INT_SAMPLER_2D]="uniform1i",r.UNIFORM_FUNC_NAME[s.UNSIGNED_INT_SAMPLER_2D]="uniform1i",r.UNIFORM_FUNC_NAME[s.SAMPLER_2D_SHADOW]="uniform1i",r.UNIFORM_FUNC_NAME[s.SAMPLER_2D_ARRAY]="uniform1i",r.UNIFORM_FUNC_NAME[s.INT_SAMPLER_2D_ARRAY]="uniform1i",r.UNIFORM_FUNC_NAME[s.UNSIGNED_INT_SAMPLER_2D_ARRAY]="uniform1i",r.UNIFORM_FUNC_NAME[s.SAMPLER_2D_ARRAY_SHADOW]="uniform1i",r.UNIFORM_FUNC_NAME[s.SAMPLER_CUBE]="uniform1i",r.UNIFORM_FUNC_NAME[s.INT_SAMPLER_CUBE]="uniform1i",r.UNIFORM_FUNC_NAME[s.UNSIGNED_INT_SAMPLER_CUBE]="uniform1i",r.UNIFORM_FUNC_NAME[s.SAMPLER_CUBE_SHADOW]="uniform1i",r.UNIFORM_FUNC_NAME[s.SAMPLER_3D]="uniform1i",r.UNIFORM_FUNC_NAME[s.INT_SAMPLER_3D]="uniform1i",r.UNIFORM_FUNC_NAME[s.UNSIGNED_INT_SAMPLER_3D]="uniform1i",r.UNIFORM_FUNC_NAME[s.UNSIGNED_INT]="uniform1ui",r.UNIFORM_FUNC_NAME[s.FLOAT]="uniform1f",r.UNIFORM_FUNC_NAME[s.FLOAT_VEC2]="uniform2f",r.UNIFORM_FUNC_NAME[s.FLOAT_VEC3]="uniform3f",r.UNIFORM_FUNC_NAME[s.FLOAT_VEC4]="uniform4f",r.UNIFORM_FUNC_NAME[s.INT_VEC2]="uniform2i",r.UNIFORM_FUNC_NAME[s.INT_VEC3]="uniform3i",r.UNIFORM_FUNC_NAME[s.INT_VEC4]="uniform4i",r.UNIFORM_FUNC_NAME[s.UNSIGNED_INT_VEC2]="uniform2ui",r.UNIFORM_FUNC_NAME[s.UNSIGNED_INT_VEC3]="uniform3ui",r.UNIFORM_FUNC_NAME[s.UNSIGNED_INT_VEC4]="uniform4ui",r.UNIFORM_FUNC_NAME[s.BOOL_VEC2]="uniform2i",r.UNIFORM_FUNC_NAME[s.BOOL_VEC3]="uniform3i",r.UNIFORM_FUNC_NAME[s.BOOL_VEC4]="uniform4i",r.UNIFORM_FUNC_NAME[s.FLOAT_MAT2]="uniformMatrix2fv",r.UNIFORM_FUNC_NAME[s.FLOAT_MAT3]="uniformMatrix3fv",r.UNIFORM_FUNC_NAME[s.FLOAT_MAT4]="uniformMatrix4fv",r.UNIFORM_FUNC_NAME[s.FLOAT_MAT2x3]="uniformMatrix2x3fv",r.UNIFORM_FUNC_NAME[s.FLOAT_MAT2x4]="uniformMatrix2x4fv",r.UNIFORM_FUNC_NAME[s.FLOAT_MAT3x2]="uniformMatrix3x2fv",r.UNIFORM_FUNC_NAME[s.FLOAT_MAT3x4]="uniformMatrix3x4fv",r.UNIFORM_FUNC_NAME[s.FLOAT_MAT4x2]="uniformMatrix4x2fv",r.UNIFORM_FUNC_NAME[s.FLOAT_MAT4x3]="uniformMatrix4x3fv",r.UNIFORM_COMPONENT_COUNT={},r.UNIFORM_COMPONENT_COUNT[s.BOOL]=1,r.UNIFORM_COMPONENT_COUNT[s.INT]=1,r.UNIFORM_COMPONENT_COUNT[s.SAMPLER_2D]=1,r.UNIFORM_COMPONENT_COUNT[s.INT_SAMPLER_2D]=1,r.UNIFORM_COMPONENT_COUNT[s.UNSIGNED_INT_SAMPLER_2D]=1,r.UNIFORM_COMPONENT_COUNT[s.SAMPLER_2D_SHADOW]=1,r.UNIFORM_COMPONENT_COUNT[s.SAMPLER_2D_ARRAY]=1,r.UNIFORM_COMPONENT_COUNT[s.INT_SAMPLER_2D_ARRAY]=1,r.UNIFORM_COMPONENT_COUNT[s.UNSIGNED_INT_SAMPLER_2D_ARRAY]=1,r.UNIFORM_COMPONENT_COUNT[s.SAMPLER_2D_ARRAY_SHADOW]=1,r.UNIFORM_COMPONENT_COUNT[s.SAMPLER_CUBE]=1,r.UNIFORM_COMPONENT_COUNT[s.INT_SAMPLER_CUBE]=1,r.UNIFORM_COMPONENT_COUNT[s.UNSIGNED_INT_SAMPLER_CUBE]=1,r.UNIFORM_COMPONENT_COUNT[s.SAMPLER_CUBE_SHADOW]=1,r.UNIFORM_COMPONENT_COUNT[s.SAMPLER_3D]=1,r.UNIFORM_COMPONENT_COUNT[s.INT_SAMPLER_3D]=1,r.UNIFORM_COMPONENT_COUNT[s.UNSIGNED_INT_SAMPLER_3D]=1,r.UNIFORM_COMPONENT_COUNT[s.UNSIGNED_INT]=1,r.UNIFORM_COMPONENT_COUNT[s.FLOAT]=1,r.UNIFORM_COMPONENT_COUNT[s.FLOAT_VEC2]=2,r.UNIFORM_COMPONENT_COUNT[s.FLOAT_VEC3]=3,r.UNIFORM_COMPONENT_COUNT[s.FLOAT_VEC4]=4,r.UNIFORM_COMPONENT_COUNT[s.INT_VEC2]=2,r.UNIFORM_COMPONENT_COUNT[s.INT_VEC3]=3,r.UNIFORM_COMPONENT_COUNT[s.INT_VEC4]=4,r.UNIFORM_COMPONENT_COUNT[s.UNSIGNED_INT_VEC2]=2,r.UNIFORM_COMPONENT_COUNT[s.UNSIGNED_INT_VEC3]=3,r.UNIFORM_COMPONENT_COUNT[s.UNSIGNED_INT_VEC4]=4,r.UNIFORM_COMPONENT_COUNT[s.BOOL_VEC2]=2,r.UNIFORM_COMPONENT_COUNT[s.BOOL_VEC3]=3,r.UNIFORM_COMPONENT_COUNT[s.BOOL_VEC4]=4,r.UNIFORM_COMPONENT_COUNT[s.FLOAT_MAT2]=4,r.UNIFORM_COMPONENT_COUNT[s.FLOAT_MAT3]=9,r.UNIFORM_COMPONENT_COUNT[s.FLOAT_MAT4]=16,r.UNIFORM_COMPONENT_COUNT[s.FLOAT_MAT2x3]=6,r.UNIFORM_COMPONENT_COUNT[s.FLOAT_MAT2x4]=8,r.UNIFORM_COMPONENT_COUNT[s.FLOAT_MAT3x2]=6,r.UNIFORM_COMPONENT_COUNT[s.FLOAT_MAT3x4]=12,r.UNIFORM_COMPONENT_COUNT[s.FLOAT_MAT4x2]=8,r.UNIFORM_COMPONENT_COUNT[s.FLOAT_MAT4x3]=12,r.UNIFORM_CACHE_CLASS={},r.UNIFORM_CACHE_CLASS[s.INT]=Int32Array,r.UNIFORM_CACHE_CLASS[s.SAMPLER_2D]=Int32Array,r.UNIFORM_CACHE_CLASS[s.INT_SAMPLER_2D]=Int32Array,r.UNIFORM_CACHE_CLASS[s.UNSIGNED_INT_SAMPLER_2D]=Int32Array,r.UNIFORM_CACHE_CLASS[s.SAMPLER_2D_SHADOW]=Int32Array,r.UNIFORM_CACHE_CLASS[s.SAMPLER_2D_ARRAY]=Int32Array,r.UNIFORM_CACHE_CLASS[s.INT_SAMPLER_2D_ARRAY]=Int32Array,r.UNIFORM_CACHE_CLASS[s.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Int32Array,r.UNIFORM_CACHE_CLASS[s.SAMPLER_2D_ARRAY_SHADOW]=Int32Array,r.UNIFORM_CACHE_CLASS[s.SAMPLER_CUBE]=Int32Array,r.UNIFORM_CACHE_CLASS[s.INT_SAMPLER_CUBE]=Int32Array,r.UNIFORM_CACHE_CLASS[s.UNSIGNED_INT_SAMPLER_CUBE]=Int32Array,r.UNIFORM_CACHE_CLASS[s.SAMPLER_CUBE_SHADOW]=Int32Array,r.UNIFORM_CACHE_CLASS[s.SAMPLER_3D]=Int32Array,r.UNIFORM_CACHE_CLASS[s.INT_SAMPLER_3D]=Int32Array,r.UNIFORM_CACHE_CLASS[s.UNSIGNED_INT_SAMPLER_3D]=Int32Array,r.UNIFORM_CACHE_CLASS[s.UNSIGNED_INT]=Uint32Array,r.UNIFORM_CACHE_CLASS[s.FLOAT]=Float32Array,r.UNIFORM_CACHE_CLASS[s.FLOAT_VEC2]=Float32Array,r.UNIFORM_CACHE_CLASS[s.FLOAT_VEC3]=Float32Array,r.UNIFORM_CACHE_CLASS[s.FLOAT_VEC4]=Float32Array,r.UNIFORM_CACHE_CLASS[s.INT_VEC2]=Int32Array,r.UNIFORM_CACHE_CLASS[s.INT_VEC3]=Int32Array,r.UNIFORM_CACHE_CLASS[s.INT_VEC4]=Int32Array,r.UNIFORM_CACHE_CLASS[s.UNSIGNED_INT_VEC2]=Uint32Array,r.UNIFORM_CACHE_CLASS[s.UNSIGNED_INT_VEC3]=Uint32Array,r.UNIFORM_CACHE_CLASS[s.UNSIGNED_INT_VEC4]=Uint32Array,r.WEBGL_INFO={},r.WEBGL_INFO.MAX_TEXTURE_UNITS=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS),r.WEBGL_INFO.MAX_UNIFORM_BUFFERS=s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS),r.DUMMY_OBJECT={},e.exports=r},{}],7:[function(t,e,i){"use strict";var r=t("./picogl"),s=t("./shader"),n=t("./uniforms"),h=function(t,e,i,h){var a,o,u,_=!1,E=!1;"string"==typeof e?(o=new s(t,t.VERTEX_SHADER,e),_=!0):o=e,"string"==typeof i?(u=new s(t,t.FRAGMENT_SHADER,i),E=!0):u=i;var l=t.createProgram();t.attachShader(l,o.shader),t.attachShader(l,u.shader),h&&t.transformFeedbackVaryings(l,h,t.SEPARATE_ATTRIBS),t.linkProgram(l),t.getProgramParameter(l,t.LINK_STATUS)||console.error(t.getProgramInfoLog(l)),_&&o.delete(),E&&u.delete(),this.gl=t,this.program=l,this.transformFeedback=!!h,this.uniforms={},this.uniformBlocks={},this.uniformBlockBindings={};var T=t.getProgramParameter(l,t.ACTIVE_UNIFORMS);for(a=0;a<T;++a){var f=t.getActiveUniform(l,a),N=t.getUniformLocation(this.program,f.name),A=null,p=f.type,c=f.size;switch(p){case r.INT:case r.SAMPLER_2D:case r.INT_SAMPLER_2D:case r.UNSIGNED_INT_SAMPLER_2D:case r.SAMPLER_2D_SHADOW:case r.SAMPLER_2D_ARRAY:case r.INT_SAMPLER_2D_ARRAY:case r.UNSIGNED_INT_SAMPLER_2D_ARRAY:case r.SAMPLER_2D_ARRAY_SHADOW:case r.SAMPLER_CUBE:case r.INT_SAMPLER_CUBE:case r.UNSIGNED_INT_SAMPLER_CUBE:case r.SAMPLER_CUBE_SHADOW:case r.SAMPLER_3D:case r.INT_SAMPLER_3D:case r.UNSIGNED_INT_SAMPLER_3D:case r.UNSIGNED_INT:case r.FLOAT:A=c>1?n.MultiNumericUniform:n.SingleComponentUniform;break;case r.BOOL:A=c>1?n.MultiBoolUniform:n.SingleComponentUniform;break;case r.FLOAT_VEC2:case r.INT_VEC2:case r.UNSIGNED_INT_VEC2:case r.FLOAT_VEC3:case r.INT_VEC3:case r.UNSIGNED_INT_VEC3:case r.FLOAT_VEC4:case r.INT_VEC4:case r.UNSIGNED_INT_VEC4:A=n.MultiNumericUniform;break;case r.BOOL_VEC2:case r.BOOL_VEC3:case r.BOOL_VEC4:A=n.MultiBoolUniform;break;case r.FLOAT_MAT2:case r.FLOAT_MAT3:case r.FLOAT_MAT4:case r.FLOAT_MAT2x3:case r.FLOAT_MAT2x4:case r.FLOAT_MAT3x2:case r.FLOAT_MAT3x4:case r.FLOAT_MAT4x2:case r.FLOAT_MAT4x3:A=n.MatrixUniform;break;default:console.error("Unrecognized type for uniform ",f.name)}this.uniforms[f.name]=new A(t,N,p,c)}var m=t.getProgramParameter(l,t.ACTIVE_UNIFORM_BLOCKS);for(a=0;a<m;++a){var g=t.getActiveUniformBlockName(this.program,a),F=t.getUniformBlockIndex(this.program,g);this.uniformBlocks[g]=F}};h.prototype.delete=function(){this.program&&(this.gl.deleteProgram(this.program),this.program=null)},h.prototype.uniform=function(t,e){this.uniforms[t].set(e)},h.prototype.uniformBlock=function(t,e){this.uniformBlockBindings[t]!==e&&(this.gl.uniformBlockBinding(this.program,this.uniformBlocks[t],e),this.uniformBlockBindings[t]=e)},e.exports=h},{"./picogl":6,"./shader":8,"./uniforms":13}],8:[function(t,e,i){"use strict";var r=function(t,e,i){if(this.gl=t,this.shader=t.createShader(e),t.shaderSource(this.shader,i),t.compileShader(this.shader),!t.getShaderParameter(this.shader,t.COMPILE_STATUS)){var r,s;for(console.error(t.getShaderInfoLog(this.shader)),s=i.split("\n"),r=0;r<s.length;++r)console.error(r+1+":",s[r])}};r.prototype.delete=function(){this.shader&&(this.gl.deleteShader(this.shader),this.shader=null)},e.exports=r},{}],9:[function(t,e,i){"use strict";var r=t("./picogl"),s=function(t,e,i,s,n,h,a,o,u){u=u||r.DUMMY_OBJECT,this.gl=t,this.binding=i,this.texture=t.createTexture(),this.width=-1,this.height=-1,this.depth=-1,this.format=void 0!==u.format?u.format:t.RGBA,this.type=void 0!==u.type?u.type:t.UNSIGNED_BYTE,this.internalFormat=void 0!==u.internalFormat?u.internalFormat:r.TEXTURE_INTERNAL_FORMAT[this.type][this.format],this.is3D=o,this.appState=e,e.freeTextureUnits.length>0?this.unit=e.freeTextureUnits.pop():(this.unit=e.textureCount%(e.textures.length-1),this.unit+=1,++e.textureCount),this.unitEnum=t.TEXTURE0+this.unit;var _=void 0!==u.minFilter?u.minFilter:t.LINEAR_MIPMAP_NEAREST,E=void 0!==u.magFilter?u.magFilter:t.LINEAR,l=void 0!==u.wrapS?u.wrapS:t.REPEAT,T=void 0!==u.wrapT?u.wrapT:t.REPEAT,f=void 0!==u.wrapR?u.wrapR:t.REPEAT,N=void 0!==u.compareMode?u.compareMode:t.NONE,A=void 0!==u.compareFunc?u.compareFunc:t.LEQUAL,p=void 0!==u.minLOD?u.minLOD:null,c=void 0!==u.maxLOD?u.maxLOD:null;this.sampler=t.createSampler(),t.samplerParameteri(this.sampler,t.TEXTURE_MIN_FILTER,_),t.samplerParameteri(this.sampler,t.TEXTURE_MAG_FILTER,E),t.samplerParameteri(this.sampler,t.TEXTURE_WRAP_S,l),t.samplerParameteri(this.sampler,t.TEXTURE_WRAP_T,T),t.samplerParameteri(this.sampler,t.TEXTURE_WRAP_R,f),t.samplerParameteri(this.sampler,t.TEXTURE_COMPARE_FUNC,A),t.samplerParameteri(this.sampler,t.TEXTURE_COMPARE_MODE,N),null!==p&&t.samplerParameterf(this.sampler,t.TEXTURE_MIN_LOD,p),null!==c&&t.samplerParameterf(this.sampler,t.TEXTURE_MAX_LOD,c),this.flipY=void 0!==u.flipY&&u.flipY,this.baseLevel=void 0!==u.baseLevel?u.baseLevel:null,this.maxLevel=void 0!==u.maxLevel?u.maxLevel:null,this.generateMipmaps=!1!==u.generateMipmaps&&(_===t.LINEAR_MIPMAP_NEAREST||_===t.LINEAR_MIPMAP_LINEAR),this.bind(!0),t.bindSampler(this.unit,this.sampler),this.image(s,n,h,a)};s.prototype.image=function(t,e,i,r){return e=e||t.width,i=i||t.height,r=r||0,e===this.width&&i===this.height&&r===this.depth||(this.gl.deleteTexture(this.texture),this.texture=this.gl.createTexture(),this.bind(!0),this.width=e||t.width,this.height=i||t.height,this.depth=r||0,this.allocateStorage()),t&&(this.is3D?this.gl.texSubImage3D(this.binding,0,0,0,0,this.width,this.height,this.depth,this.format,this.type,t):this.gl.texSubImage2D(this.binding,0,0,0,this.width,this.height,this.format,this.type,t),this.generateMipmaps&&this.gl.generateMipmap(this.binding)),this},s.prototype.delete=function(){this.texture&&(this.gl.deleteTexture(this.texture),this.gl.deleteSampler(this.sampler),this.texture=null,this.sampler=null,this.appState.freeTextureUnits.push(this.unit),this.appState.textures[this.unit]=null,this.unit=-1,this.unitEnum=-1)},s.prototype.allocateStorage=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),null!==this.baseLevel&&this.gl.texParameteri(this.binding,this.gl.TEXTURE_BASE_LEVEL,this.baseLevel),null!==this.maxLevel&&this.gl.texParameteri(this.binding,this.gl.TEXTURE_MAX_LEVEL,this.maxLevel);var t;this.is3D?(t=this.generateMipmaps?Math.floor(Math.log2(Math.max(Math.max(this.width,this.height),this.depth)))+1:1,this.gl.texStorage3D(this.binding,t,this.internalFormat,this.width,this.height,this.depth)):(t=this.generateMipmaps?Math.floor(Math.log2(Math.max(this.width,this.height)))+1:1,this.gl.texStorage2D(this.binding,t,this.internalFormat,this.width,this.height))},s.prototype.activateUnit=function(){return this.appState.activeTexture!==this.unit&&(this.gl.activeTexture(this.unitEnum),this.appState.activeTexture=this.unit),this},s.prototype.bind=function(t){return(t||this.appState.textures[this.unit]!==this)&&(this.activateUnit(),this.gl.bindTexture(this.binding,this.texture),this.appState.textures[this.unit]=this),this},e.exports=s},{"./picogl":6}],10:[function(t,e,i){"use strict";var r=function(t){this.gl=t,this.cpuTimer=window.performance||window.Date;var e=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")||this.gl.getExtension("EXT_disjoint_timer_query");e?(this.gpuTimer=!0,this.gpuTimerQuery=this.gl.createQuery(),this.TIME_ELAPSED_EXT=e.TIME_ELAPSED_EXT,this.GPU_DISJOINT_EXT=e.GPU_DISJOINT_EXT):(this.gpuTimer=!1,this.gpuTimerQuery=null,this.TIME_ELAPSED_EXT=null,this.GPU_DISJOINT_EXT=null),this.gpuTimerQueryInProgress=!1,this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0};r.prototype.start=function(){this.gpuTimer?this.gpuTimerQueryInProgress||(this.gl.beginQuery(this.TIME_ELAPSED_EXT,this.gpuTimerQuery),this.cpuStartTime=this.cpuTimer.now()):this.cpuStartTime=this.cpuTimer.now()},r.prototype.end=function(){this.gpuTimer?this.gpuTimerQueryInProgress||(this.gl.endQuery(this.TIME_ELAPSED_EXT),this.cpuTime=this.cpuTimer.now()-this.cpuStartTime,this.gpuTimerQueryInProgress=!0):this.cpuTime=this.cpuTimer.now()-this.cpuStartTime},r.prototype.ready=function(){if(this.gpuTimer){if(!this.gpuTimerQueryInProgress)return!1;var t=this.gl.getQueryParameter(this.gpuTimerQuery,this.gl.QUERY_RESULT_AVAILABLE),e=this.gl.getParameter(this.GPU_DISJOINT_EXT);return t&&(this.gpuTimerQueryInProgress=!1),!(!t||e)&&(this.gpuTime=this.gl.getQueryParameter(this.gpuTimerQuery,this.gl.QUERY_RESULT)/1e6,!0)}return!!this.cpuStartTime},e.exports=r},{}],11:[function(t,e,i){"use strict";var r=function(t){this.gl=t,this.transformFeedback=t.createTransformFeedback(),this.angleBugBuffers=[]};r.prototype.feedbackBuffer=function(t,e){return this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,this.transformFeedback),this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,t,e.buffer),this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null),this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,t,null),this.angleBugBuffers[t]=e,this},r.prototype.delete=function(){this.transformFeedback&&(this.gl.deleteTransformFeedback(this.transformFeedback),this.transformFeedback=null)},r.prototype.bind=function(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,this.transformFeedback);for(var t=0,e=this.angleBugBuffers.length;t<e;++t)this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,t,this.angleBugBuffers[t].buffer);return this},e.exports=r},{}],12:[function(t,e,i){"use strict";var r=t("./picogl"),s=function(t,e,i){this.gl=t,this.buffer=t.createBuffer(),this.dataViews={},this.offsets=new Array(e.length),this.sizes=new Array(e.length),this.types=new Array(e.length),this.size=0,this.usage=i||t.DYNAMIC_DRAW;for(var s=0,n=e.length;s<n;++s){var h=e[s];switch(h){case r.FLOAT:case r.INT:case r.UNSIGNED_INT:case r.BOOL:this.offsets[s]=this.size,this.sizes[s]=1,h===r.INT?this.types[s]=r.INT:this.type===r.UNSIGNED_INT?this.types[s]=r.UNSIGNED_INT:this.types[s]=r.FLOAT,this.size++;break;case r.FLOAT_VEC2:case r.INT_VEC2:case r.UNSIGNED_INT_VEC2:case r.BOOL_VEC2:this.size+=this.size%2,this.offsets[s]=this.size,this.sizes[s]=2,h===r.INT_VEC2?this.types[s]=r.INT:this.type===r.UNSIGNED_INT_VEC2?this.types[s]=r.UNSIGNED_INT:this.types[s]=r.FLOAT,this.size+=2;break;case r.FLOAT_VEC3:case r.INT_VEC3:case r.UNSIGNED_INT_VEC3:case r.BOOL_VEC3:case r.FLOAT_VEC4:case r.INT_VEC4:case r.UNSIGNED_INT_VEC4:case r.BOOL_VEC4:this.size+=(4-this.size%4)%4,this.offsets[s]=this.size,this.sizes[s]=4,h===r.INT_VEC4||h===r.INT_VEC3?this.types[s]=r.INT:this.type===r.UNSIGNED_INT_VEC4||this.type===r.UNSIGNED_INT_VEC3?this.types[s]=r.UNSIGNED_INT:this.types[s]=r.FLOAT,this.size+=4;break;case r.FLOAT_MAT2:case r.FLOAT_MAT2x3:case r.FLOAT_MAT2x4:this.size+=(4-this.size%4)%4,this.offsets[s]=this.size,this.sizes[s]=8,this.types[s]=r.FLOAT,this.size+=8;break;case r.FLOAT_MAT3:case r.FLOAT_MAT3x2:case r.FLOAT_MAT3x4:this.size+=(4-this.size%4)%4,this.offsets[s]=this.size,this.sizes[s]=12,this.types[s]=r.FLOAT,this.size+=12;break;case r.FLOAT_MAT4:case r.FLOAT_MAT4x2:case r.FLOAT_MAT4x3:this.size+=(4-this.size%4)%4,this.offsets[s]=this.size,this.sizes[s]=16,this.types[s]=r.FLOAT,this.size+=16;break;default:console.error("Unsupported type for uniform buffer.")}}this.size+=(4-this.size%4)%4,this.data=new Float32Array(this.size),this.dataViews[r.FLOAT]=this.data,this.dataViews[r.INT]=new Int32Array(this.data.buffer),this.dataViews[r.UNSIGNED_INT]=new Uint32Array(this.data.buffer),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,0,this.buffer),this.gl.bufferData(this.gl.UNIFORM_BUFFER,4*this.size,this.usage),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,0,null)};s.prototype.set=function(t,e){var i=this.dataViews[this.types[t]];return 1===this.sizes[t]?i[this.offsets[t]]=e:i.set(e,this.offsets[t]),this},s.prototype.update=function(t){var e,i;if(void 0===t)e=this.data,i=0;else{var r=this.offsets[t],s=r+this.sizes[t];e=this.data.subarray(r,s),i=4*r}return this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,0,this.buffer),this.gl.bufferSubData(this.gl.UNIFORM_BUFFER,i,e),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,0,null),this},s.prototype.delete=function(){this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null)},s.prototype.bind=function(t){return this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,t,this.buffer),this},e.exports=s},{"./picogl":6}],13:[function(t,e,i){"use strict";var r=t("./picogl"),s=function(t,e,i){this.gl=t,this.handle=e,this.glFuncName=r.UNIFORM_FUNC_NAME[i],this.cache=i!==r.BOOL&&0};s.prototype.set=function(t){this.cache!==t&&(this.gl[this.glFuncName](this.handle,t),this.cache=t)};var n=function(t,e,i,s){this.gl=t,this.handle=e,this.glFuncName=r.UNIFORM_FUNC_NAME[i]+"v",this.count=s,this.cache=new r.UNIFORM_CACHE_CLASS[i](r.UNIFORM_COMPONENT_COUNT[i]*s)};n.prototype.set=function(t){for(var e=0,i=t.length;e<i;++e)if(this.cache[e]!==t[e])return this.gl[this.glFuncName](this.handle,t),void this.cache.set(t)};var h=function(t,e,i,s){this.gl=t,this.handle=e,this.glFuncName=r.UNIFORM_FUNC_NAME[i]+"v",this.count=s,this.cache=new Array(r.UNIFORM_COMPONENT_COUNT[i]*s).fill(!1)};h.prototype.set=function(t){for(var e=0,i=t.length;e<i;++e)if(this.cache[e]!==t[e]){this.gl[this.glFuncName](this.handle,t);for(var r=e;r<i;r++)this.cache[r]=t[r];return}};var a=function(t,e,i,s){this.gl=t,this.handle=e,this.glFuncName=r.UNIFORM_FUNC_NAME[i],this.count=s,this.cache=new Float32Array(r.UNIFORM_COMPONENT_COUNT[i]*s)};a.prototype.set=function(t){for(var e=0,i=t.length;e<i;++e)if(this.cache[e]!==t[e])return this.gl[this.glFuncName](this.handle,!1,t),void this.cache.set(t)},e.exports.MatrixUniform=a,e.exports.MultiBoolUniform=h,e.exports.MultiNumericUniform=n,e.exports.SingleComponentUniform=s},{"./picogl":6}],14:[function(t,e,i){"use strict";var r=t("./picogl"),s=function(t){this.gl=t,this.vertexArray=t.createVertexArray(),this.numElements=0,this.indexType=null,this.instancedBuffers=0,this.indexed=!1,this.numInstances=0};s.prototype.vertexAttributeBuffer=function(t,e){return this.attributeBuffer(t,e,!1),this},s.prototype.instanceAttributeBuffer=function(t,e){return this.attributeBuffer(t,e,!0),this},s.prototype.indexBuffer=function(t){return this.gl.bindVertexArray(this.vertexArray),this.gl.bindBuffer(t.binding,t.buffer),this.numElements=3*t.numItems,this.indexType=t.type,this.indexed=!0,this.gl.bindVertexArray(null),this.gl.bindBuffer(t.binding,null),this},s.prototype.delete=function(){return this.vertexArray&&(this.gl.deleteVertexArray(this.vertexArray),this.vertexArray=null),this.gl.bindVertexArray(null),this},s.prototype.bind=function(){return this.gl.bindVertexArray(this.vertexArray),this},s.prototype.attributeBuffer=function(t,e,i){this.gl.bindVertexArray(this.vertexArray),this.gl.bindBuffer(e.binding,e.buffer);for(var s=e.numColumns,n=0;n<s;++n)e.type===this.gl.FLOAT?this.gl.vertexAttribPointer(t+n,e.itemSize,e.type,!1,s*e.itemSize*r.TYPE_SIZE[e.type],n*e.itemSize*r.TYPE_SIZE[e.type]):this.gl.vertexAttribIPointer(t+n,e.itemSize,e.type,s*e.itemSize*r.TYPE_SIZE[e.type],n*e.itemSize*r.TYPE_SIZE[e.type]),i&&this.gl.vertexAttribDivisor(t+n,1),this.gl.enableVertexAttribArray(t+n);return this.instanced=this.instanced||i,i?this.numInstances=e.numItems:this.numElements=this.numElements||e.numItems,this.gl.bindVertexArray(null),this.gl.bindBuffer(e.binding,null),this},e.exports=s},{"./picogl":6}],15:[function(t,e,i){"use strict";var r=t("./picogl"),s=function(t,e,i,s,n,h){var a;switch(e){case r.FLOAT_MAT4:case r.FLOAT_MAT4x2:case r.FLOAT_MAT4x3:a=4;break;case r.FLOAT_MAT3:case r.FLOAT_MAT3x2:case r.FLOAT_MAT3x4:a=3;break;case r.FLOAT_MAT2:case r.FLOAT_MAT2x3:case r.FLOAT_MAT2x4:a=2;break;default:a=1}switch(e){case r.FLOAT_MAT4:case r.FLOAT_MAT3x4:case r.FLOAT_MAT2x4:i=4,e=r.FLOAT;break;case r.FLOAT_MAT3:case r.FLOAT_MAT4x3:case r.FLOAT_MAT2x3:i=3,e=r.FLOAT;break;case r.FLOAT_MAT2:case r.FLOAT_MAT3x2:case r.FLOAT_MAT4x2:i=2,e=r.FLOAT}var o;"number"==typeof s?(o=s,s*=r.TYPE_SIZE[e]):o=s.length,this.gl=t,this.buffer=t.createBuffer(),this.type=e,this.itemSize=i,this.numItems=o/(i*a),this.numColumns=a,this.usage=n||t.STATIC_DRAW,this.indexArray=!!h,this.binding=this.indexArray?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER,t.bindBuffer(this.binding,this.buffer),t.bufferData(this.binding,s,this.usage),t.bindBuffer(this.binding,null)};s.prototype.data=function(t){return this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferSubData(this.binding,0,t),this.gl.bindBuffer(this.binding,null),this},s.prototype.delete=function(){this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null)},e.exports=s},{"./picogl":6}]},{},[5])(5)});
