/*
PicoGL.js v0.6.10

The MIT License (MIT)

Copyright (c) 2017 Tarek Sherif

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PicoGL=t()}}(function(){return function t(e,i,r){function s(E,a){if(!i[E]){if(!e[E]){var h="function"==typeof require&&require;if(!a&&h)return h(E,!0);if(_)return _(E,!0);var S=new Error("Cannot find module '"+E+"'");throw S.code="MODULE_NOT_FOUND",S}var n=i[E]={exports:{}};e[E][0].call(n.exports,function(t){var i=e[E][1][t];return s(i||t)},n,n.exports,t,e,i,r)}return i[E].exports}for(var _="function"==typeof require&&require,E=0;E<r.length;E++)s(r[E]);return s}({1:[function(t,e,i){"use strict";const r=t("./constants"),s=t("./texture-format-defaults"),_=t("./cubemap"),E=t("./draw-call"),a=t("./framebuffer"),h=t("./program"),S=t("./shader"),n=t("./texture"),T=t("./timer"),R=t("./transform-feedback"),A=t("./uniform-buffer"),l=t("./vertex-array"),u=t("./vertex-buffer"),o=t("./query");class f{constructor(t,e){this.canvas=t,this.gl=t.getContext("webgl2",e),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.currentDrawCalls=null,this.emptyFragmentShader=null,this.state={program:null,vertexArray:null,transformFeedback:null,activeTexture:-1,textures:new Array(r.WEBGL_INFO.MAX_TEXTURE_UNITS),uniformBuffers:new Array(r.WEBGL_INFO.MAX_UNIFORM_BUFFERS),uniformBufferCount:0,freeUniformBufferBases:[],drawFramebuffer:null,readFramebuffer:null},this.clearBits=this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT,this.cpuTime=0,this.gpuTime=0,this.floatRenderTargetsEnabled=!1,this.linearFloatTexturesEnabled=!1,this.s3tcTexturesEnabled=!1,this.s3tcSRGBTexturesEnabled=!1,this.etcTexturesEnabled=!1,this.astcTexturesEnabled=!1,this.pvrtcTexturesEnabled=!1,this.viewport(0,0,this.width,this.height)}colorMask(t,e,i,r){return this.gl.colorMask(t,e,i,r),this}clearColor(t,e,i,r){return this.gl.clearColor(t,e,i,r),this}clearMask(t){return this.clearBits=t,this}clear(){return this.gl.clear(this.clearBits),this}drawFramebuffer(t){return t.bindForDraw(),this.viewport(0,0,t.width,t.height),this}readFramebuffer(t){return t.bindForRead(),this}defaultDrawFramebuffer(){return null!==this.state.drawFramebuffer&&(this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,null),this.state.drawFramebuffer=null,this.viewport(0,0,this.width,this.height)),this}defaultReadFramebuffer(){return null!==this.state.readFramebuffer&&(this.gl.bindFramebuffer(this.gl.READ_FRAMEBUFFER,null),this.state.readFramebuffer=null),this}depthRange(t,e){return this.gl.depthRange(t,e),this}depthTest(){return this.gl.enable(this.gl.DEPTH_TEST),this}noDepthTest(){return this.gl.disable(this.gl.DEPTH_TEST),this}depthMask(t){return this.gl.depthMask(t),this}depthFunc(t){return this.gl.depthFunc(t),this}blend(){return this.gl.enable(this.gl.BLEND),this}noBlend(){return this.gl.disable(this.gl.BLEND),this}blendFunc(t,e){return this.gl.blendFunc(t,e),this}blendFuncSeparate(t,e,i,r){return this.gl.blendFuncSeparate(t,e,i,r),this}stencilTest(){return this.gl.enable(this.gl.STENCIL_TEST),this}noStencilTest(){return this.gl.disable(this.gl.STENCIL_TEST),this}scissorTest(){return this.gl.enable(this.gl.SCISSOR_TEST),this}noScissorTest(){return this.gl.disable(this.gl.SCISSOR_TEST),this}scissor(t,e,i,r){return this.gl.scissor(t,e,i,r),this}stencilMask(t){return this.gl.stencilMask(t),this}stencilMaskSeparate(t,e){return this.gl.stencilMaskSeparate(t,e),this}stencilFunc(t,e,i){return this.gl.stencilFunc(t,e,i),this}stencilFuncSeparate(t,e,i,r){return this.gl.stencilFuncSeparate(t,e,i,r),this}stencilOp(t,e,i){return this.gl.stencilOp(t,e,i),this}stencilOpSeparate(t,e,i,r){return this.gl.stencilOpSeparate(t,e,i,r),this}rasterize(){return this.gl.disable(this.gl.RASTERIZER_DISCARD),this}noRasterize(){return this.gl.enable(this.gl.RASTERIZER_DISCARD),this}cullBackfaces(){return this.gl.enable(this.gl.CULL_FACE),this}drawBackfaces(){return this.gl.disable(this.gl.CULL_FACE),this}floatRenderTargets(){return this.floatRenderTargetsEnabled=!!this.gl.getExtension("EXT_color_buffer_float"),this}linearFloatTextures(){return this.linearFloatTexturesEnabled=!!this.gl.getExtension("OES_texture_float_linear"),this}s3tcTextures(){let t=this.gl.getExtension("WEBGL_compressed_texture_s3tc");return this.s3tcTexturesEnabled=!!t,this.s3tcTexturesEnabled&&(r.COMPRESSED_RGB_S3TC_DXT1_EXT=t.COMPRESSED_RGB_S3TC_DXT1_EXT,r.COMPRESSED_RGBA_S3TC_DXT1_EXT=t.COMPRESSED_RGBA_S3TC_DXT1_EXT,r.COMPRESSED_RGBA_S3TC_DXT3_EXT=t.COMPRESSED_RGBA_S3TC_DXT3_EXT,r.COMPRESSED_RGBA_S3TC_DXT5_EXT=t.COMPRESSED_RGBA_S3TC_DXT5_EXT,s.COMPRESSED_TYPES[t.COMPRESSED_RGB_S3TC_DXT1_EXT]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_S3TC_DXT1_EXT]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_S3TC_DXT3_EXT]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_S3TC_DXT5_EXT]=!0),t=this.gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.s3tcSRGBTexturesEnabled=!!t,this.s3tcSRGBTexturesEnabled&&(r.COMPRESSED_SRGB_S3TC_DXT1_EXT=t.COMPRESSED_SRGB_S3TC_DXT1_EXT,r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB_S3TC_DXT1_EXT]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=!0),this}etcTextures(){let t=this.gl.getExtension("WEBGL_compressed_texture_etc");return this.etcTexturesEnabled=!!t,this.etcTexturesEnabled&&(r.COMPRESSED_R11_EAC=t.COMPRESSED_R11_EAC,r.COMPRESSED_SIGNED_R11_EAC=t.COMPRESSED_SIGNED_R11_EAC,r.COMPRESSED_RG11_EAC=t.COMPRESSED_RG11_EAC,r.COMPRESSED_SIGNED_RG11_EAC=t.COMPRESSED_SIGNED_RG11_EAC,r.COMPRESSED_RGB8_ETC2=t.COMPRESSED_RGB8_ETC2,r.COMPRESSED_SRGB8_ETC2=t.COMPRESSED_SRGB8_ETC2,r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,r.COMPRESSED_RGBA8_ETC2_EAC=t.COMPRESSED_RGBA8_ETC2_EAC,r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,s.COMPRESSED_TYPES[t.COMPRESSED_R11_EAC]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SIGNED_R11_EAC]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RG11_EAC]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SIGNED_RG11_EAC]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGB8_ETC2]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ETC2]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA8_ETC2_EAC]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=!0),this}astcTextures(){let t=this.gl.getExtension("WEBGL_compressed_texture_astc");if(this.astcTexturesEnabled=!!t,this.astcTexturesEnabled){r.COMPRESSED_RGBA_ASTC_4x4_KHR=t.COMPRESSED_RGBA_ASTC_4x4_KHR,r.COMPRESSED_RGBA_ASTC_5x4_KHR=t.COMPRESSED_RGBA_ASTC_5x4_KHR,r.COMPRESSED_RGBA_ASTC_5x5_KHR=t.COMPRESSED_RGBA_ASTC_5x5_KHR,r.COMPRESSED_RGBA_ASTC_6x5_KHR=t.COMPRESSED_RGBA_ASTC_6x5_KHR,r.COMPRESSED_RGBA_ASTC_6x6_KHR=t.COMPRESSED_RGBA_ASTC_6x6_KHR,r.COMPRESSED_RGBA_ASTC_8x5_KHR=t.COMPRESSED_RGBA_ASTC_8x5_KHR,r.COMPRESSED_RGBA_ASTC_8x6_KHR=t.COMPRESSED_RGBA_ASTC_8x6_KHR,r.COMPRESSED_RGBA_ASTC_8x8_KHR=t.COMPRESSED_RGBA_ASTC_8x8_KHR,r.COMPRESSED_RGBA_ASTC_10x5_KHR=t.COMPRESSED_RGBA_ASTC_10x5_KHR,r.COMPRESSED_RGBA_ASTC_10x6_KHR=t.COMPRESSED_RGBA_ASTC_10x6_KHR,r.COMPRESSED_RGBA_ASTC_10x8_KHR=t.COMPRESSED_RGBA_ASTC_10x8_KHR,r.COMPRESSED_RGBA_ASTC_10x10_KHR=t.COMPRESSED_RGBA_ASTC_10x10_KHR,r.COMPRESSED_RGBA_ASTC_12x10_KHR=t.COMPRESSED_RGBA_ASTC_12x10_KHR,r.COMPRESSED_RGBA_ASTC_12x12_KHR=t.COMPRESSED_RGBA_ASTC_12x12_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_4x4_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_5x4_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_5x5_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_6x5_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_6x6_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_8x5_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_8x6_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_8x8_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_10x5_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_10x6_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_10x8_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_10x10_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_12x10_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_ASTC_12x12_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR]=!0,this.gl.getError(),this.state.textures[0]=null,this.gl.activeTexture(this.gl.TEXTURE0);let e=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texStorage2D(this.gl.TEXTURE_2D,1,t.COMPRESSED_RGBA_ASTC_4x4_KHR,4,4),this.gl.getError()!==this.gl.NO_ERROR&&(s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_4x4_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_5x4_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_5x5_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_6x5_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_6x6_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_8x5_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_8x6_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_8x8_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_10x5_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_10x6_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_10x8_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_10x10_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_12x10_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_RGBA_ASTC_12x12_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR]=!0,s.NO_TEX_STORAGE[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR]=!0),this.gl.deleteTexture(e)}return this}pvrtcTextures(){let t=this.gl.getExtension("WEBGL_compressed_texture_pvrtc");return this.pvrtcTexturesEnabled=!!t,this.pvrtcTexturesEnabled&&(r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,s.COMPRESSED_TYPES[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=!0,s.COMPRESSED_TYPES[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=!0),this}readPixel(t,e,i,s=r.DUMMY_OBJECT){let _=s.format||r.RGBA,E=s.type||r.UNSIGNED_BYTE;return this.gl.readPixels(t,e,1,1,_,E,i),this}viewport(t,e,i,r){return this.viewportWidth===i&&this.viewportHeight===r&&this.viewportX===t&&this.viewportY===e||(this.viewportX=t,this.viewportY=e,this.viewportWidth=i,this.viewportHeight=r,this.gl.viewport(t,e,this.viewportWidth,this.viewportHeight)),this}resize(t,e){return this.canvas.width=t,this.canvas.height=e,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewport(0,0,this.width,this.height),this}createProgram(t,e,i){return new h(this.gl,this.state,t,e,i)}createShader(t,e){return new S(this.gl,t,e)}createVertexArray(){return new l(this.gl,this.state)}createTransformFeedback(){return new R(this.gl,this.state)}createVertexBuffer(t,e,i,r){return new u(this.gl,this.state,t,e,i,r)}createMatrixBuffer(t,e,i){return new u(this.gl,this.state,t,0,e,i)}createIndexBuffer(t,e,i,r){return new u(this.gl,this.state,t,e,i,r,!0)}createUniformBuffer(t,e){return new A(this.gl,t,e)}createTexture2D(t,e,i,r){return void 0===i&&(r=e,e=t.width,i=t.height),new n(this.gl,this.state,this.gl.TEXTURE_2D,t,e,i,void 0,!1,r)}createTextureArray(t,e,i,r,s){return new n(this.gl,this.state,this.gl.TEXTURE_2D_ARRAY,t,e,i,r,!0,s)}createTexture3D(t,e,i,r,s){return new n(this.gl,this.state,this.gl.TEXTURE_3D,t,e,i,r,!0,s)}createCubemap(t){return new _(this.gl,this.state,t)}createFramebuffer(t,e){return new a(this.gl,this.state,t,e)}createQuery(t){return new o(this.gl,t)}createTimer(){return new T(this.gl)}createDrawCall(t,e,i){return new E(this.gl,this.state,t,e,i)}}e.exports=f},{"./constants":2,"./cubemap":3,"./draw-call":4,"./framebuffer":5,"./program":7,"./query":8,"./shader":9,"./texture":11,"./texture-format-defaults":10,"./timer":12,"./transform-feedback":13,"./uniform-buffer":14,"./vertex-array":16,"./vertex-buffer":17}],2:[function(t,e,i){"use strict";const r={};let s=document.createElement("canvas").getContext("webgl2");if(s)for(let t in s)t.match(/^[A-Z0-9_x]+$/)&&"number"==typeof s[t]&&(r[t]=s[t]);r.TYPE_SIZE={},r.TYPE_SIZE[s.BYTE]=1,r.TYPE_SIZE[s.UNSIGNED_BYTE]=1,r.TYPE_SIZE[s.SHORT]=2,r.TYPE_SIZE[s.UNSIGNED_SHORT]=2,r.TYPE_SIZE[s.INT]=4,r.TYPE_SIZE[s.UNSIGNED_INT]=4,r.TYPE_SIZE[s.FLOAT]=4,r.WEBGL_INFO={},r.WEBGL_INFO.MAX_TEXTURE_UNITS=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS),r.WEBGL_INFO.MAX_UNIFORM_BUFFERS=s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS),r.DUMMY_OBJECT={},e.exports=r},{}],3:[function(t,e,i){"use strict";const r=t("./texture-format-defaults");class s{constructor(t,e,i){this.gl=t,this.texture=t.createTexture(),this.format=void 0!==i.format?i.format:t.RGBA,this.type=void 0!==i.type?i.type:t.UNSIGNED_BYTE,this.internalFormat=void 0!==i.internalFormat?i.internalFormat:r[this.type][this.format],this.appState=e,this.currentUnit=-1;let s=i.negX,_=i.posX,E=i.negY,a=i.posY,h=i.negZ,S=i.posZ,n=i.width||s.width,T=i.height||s.height,R=void 0!==i.flipY&&i.flipY,A=void 0!==i.minFilter?i.minFilter:t.LINEAR_MIPMAP_NEAREST,l=void 0!==i.magFilter?i.magFilter:t.LINEAR,u=void 0!==i.compareMode?i.compareMode:t.NONE,o=void 0!==i.compareFunc?i.compareFunc:t.LEQUAL,f=!1!==i.generateMipmaps&&(A===t.LINEAR_MIPMAP_NEAREST||A===t.LINEAR_MIPMAP_LINEAR);this.bind(1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,R),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,l),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,A),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_COMPARE_FUNC,o),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_COMPARE_MODE,u),void 0!==i.baseLevel&&t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_BASE_LEVEL,i.baseLevel),void 0!==i.maxLevel&&t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAX_LEVEL,i.maxLevel),void 0!==i.minLOD&&t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_LOD,i.minLOD),void 0!==i.maxLOD&&t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAX_LOD,i.maxLOD);let C=f?Math.floor(Math.log2(Math.min(n,T)))+1:1;t.texStorage2D(t.TEXTURE_CUBE_MAP,C,this.internalFormat,n,T),t.texSubImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,0,0,n,T,this.format,this.type,s),t.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X,0,0,0,n,T,this.format,this.type,_),t.texSubImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,0,0,n,T,this.format,this.type,E),t.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,0,0,n,T,this.format,this.type,a),t.texSubImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,0,0,n,T,this.format,this.type,h),t.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,0,0,n,T,this.format,this.type,S),f&&t.generateMipmap(t.TEXTURE_CUBE_MAP)}delete(){this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.appState.textures[this.currentUnit]=null,this.currentUnit=-1)}bind(t){let e=this.appState.textures[t];return e!==this&&(e&&(e.currentUnit=-1),-1!==this.currentUnit&&(this.appState.textures[this.currentUnit]=null),this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.texture),this.appState.textures[t]=this,this.currentUnit=t),this}}e.exports=s},{"./texture-format-defaults":10}],4:[function(t,e,i){"use strict";const r=t("./constants");class s{constructor(t,e,i,s,_=r.TRIANGLES){this.gl=t,this.currentProgram=i,this.currentVertexArray=s,this.currentTransformFeedback=null,this.appState=e,this.uniformIndices={},this.uniformNames=new Array(r.WEBGL_INFO.MAX_UNIFORMS),this.uniformValues=new Array(r.WEBGL_INFO.MAX_UNIFORMS),this.uniformCount=0,this.uniformBuffers=new Array(r.WEBGL_INFO.MAX_UNIFORM_BUFFERS),this.uniformBlockNames=new Array(r.WEBGL_INFO.MAX_UNIFORM_BUFFERS),this.uniformBlockBases={},this.uniformBlockCount=0,this.samplerIndices={},this.textures=new Array(r.WEBGL_INFO.MAX_TEXTURE_UNITS),this.textureCount=0,this.primitive=_}transformFeedback(t){return this.currentTransformFeedback=t,this}uniform(t,e){let i=this.uniformIndices[t];return void 0===i&&(i=this.uniformCount++,this.uniformIndices[t]=i,this.uniformNames[i]=t),this.uniformValues[i]=e,this}texture(t,e){let i=this.currentProgram.samplers[t];return this.textures[i]=e,this}uniformBlock(t,e){let i=this.uniformBlockBases[t];return void 0===i&&(i=this.uniformBlockCount++,this.uniformBlockBases[t]=i,this.uniformBlockNames[i]=t),this.uniformBuffers[i]=e,this}draw(){let t=this.uniformNames,e=this.uniformValues,i=this.uniformBuffers,r=this.uniformBlockNames,s=this.textures,_=this.currentProgram.samplerCount;this.currentProgram.bind(),this.currentVertexArray.bind();for(let i=0;i<this.uniformCount;++i)this.currentProgram.uniform(t[i],e[i]);for(let t=0;t<this.uniformBlockCount;++t)this.currentProgram.uniformBlock(r[t],t),i[t].bind(t);for(let t=1;t<_;++t)s[t].bind(t);if(this.currentTransformFeedback&&(this.currentTransformFeedback.bind(),this.gl.beginTransformFeedback(this.primitive)),this.currentVertexArray.instanced?this.currentVertexArray.indexed?this.gl.drawElementsInstanced(this.primitive,this.currentVertexArray.numElements,this.currentVertexArray.indexType,0,this.currentVertexArray.numInstances):this.gl.drawArraysInstanced(this.primitive,0,this.currentVertexArray.numElements,this.currentVertexArray.numInstances):this.currentVertexArray.indexed?this.gl.drawElements(this.primitive,this.currentVertexArray.numElements,this.currentVertexArray.indexType,0):this.gl.drawArrays(this.primitive,0,this.currentVertexArray.numElements),this.currentTransformFeedback){this.gl.endTransformFeedback();for(let t=0,e=this.currentTransformFeedback.angleBugBuffers.length;t<e;++t)this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,t,null)}}}e.exports=s},{"./constants":2}],5:[function(t,e,i){"use strict";const r=t("./texture-format-defaults"),s=t("./texture");class _{constructor(t,e,i,r){this.gl=t,this.framebuffer=t.createFramebuffer(),this.appState=e,i&&r?(this.width=i,this.height=r):(this.width=t.drawingBufferWidth,this.height=t.drawingBufferHeight),this.numColorTargets=0,this.colorTextures=[],this.colorAttachments=[],this.depthTexture=null}colorTarget(t=0,e={}){e.type=e.type||this.gl.UNSIGNED_BYTE,e.format=e.format||this.gl.RGBA,e.internalFormat=e.internalFormat||r[e.type][e.format],e.minFilter=e.minFilter||this.gl.NEAREST,e.magFilter=e.magFilter||this.gl.NEAREST,e.wrapS=e.wrapS||this.gl.CLAMP_TO_EDGE,e.wrapT=e.wrapT||this.gl.CLAMP_TO_EDGE,e.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.colorAttachments[t]=this.gl.COLOR_ATTACHMENT0+t;let i=this.bindAndCaptureState();return this.colorTextures[t]=new s(this.gl,this.appState,this.gl.TEXTURE_2D,null,this.width,this.height,null,!1,e),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.colorAttachments[t],this.gl.TEXTURE_2D,this.colorTextures[t].texture,0),this.gl.drawBuffers(this.colorAttachments),this.numColorTargets++,this.restoreState(i),this}depthTarget(t={}){t.format=this.gl.DEPTH_COMPONENT,t.type=t.type||this.gl.UNSIGNED_SHORT,t.internalFormat=t.internalFormat||r[t.type][t.format],t.minFilter=t.minFilter||this.gl.NEAREST,t.magFilter=t.magFilter||this.gl.NEAREST,t.wrapS=t.wrapS||this.gl.CLAMP_TO_EDGE,t.wrapT=t.wrapT||this.gl.CLAMP_TO_EDGE,t.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps;let e=this.bindAndCaptureState();return this.depthTexture=new s(this.gl,this.appState,this.gl.TEXTURE_2D,null,this.width,this.height,null,!1,t),this.gl.framebufferTexture2D(this.gl.DRAW_FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0),this.restoreState(e),this}replaceTexture(t,e){this.colorTextures[t]=e;let i=this.bindAndCaptureState();return this.gl.framebufferTexture2D(this.gl.DRAW_FRAMEBUFFER,this.colorAttachments[t],this.gl.TEXTURE_2D,this.colorTextures[t].texture,0),this.restoreState(i),this}resize(t,e){t&&e?(this.width=t,this.height=e):(this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight);let i=this.bindAndCaptureState();for(let t=0;t<this.numColorTargets;++t)this.colorTextures[t].resize(this.width,this.height),this.gl.framebufferTexture2D(this.gl.DRAW_FRAMEBUFFER,this.colorAttachments[t],this.gl.TEXTURE_2D,this.colorTextures[t].texture,0);return this.depthTexture&&(this.depthTexture.resize(this.width,this.height),this.gl.framebufferTexture2D(this.gl.DRAW_FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)),this.restoreState(i),this}delete(){for(let t=0;t<this.numColorTargets;++t)this.colorTextures[t].delete();this.depthTexture&&this.depthTexture.delete(),this.framebuffer&&(this.gl.deleteFramebuffer(this.framebuffer),this.framebuffer=null)}bindForDraw(){this.appState.drawFramebuffer!==this&&(this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,this.framebuffer),this.appState.drawFramebuffer=this)}bindForRead(){this.appState.readFramebuffer!==this&&(this.gl.bindFramebuffer(this.gl.READ_FRAMEBUFFER,this.framebuffer),this.appState.readFramebuffer=this)}bindAndCaptureState(){let t=this.appState.drawFramebuffer;return t!==this&&this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,this.framebuffer),t}restoreState(t){t!==this&&this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,t?t.framebuffer:null)}}e.exports=_},{"./texture":11,"./texture-format-defaults":10}],6:[function(t,e,i){(function(i){"use strict";const r=t("./app"),s=i.PicoGL=t("./constants");s.version="0.6.10",s.createApp=function(t,e){return new r(t,e)},e.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./app":1,"./constants":2}],7:[function(t,e,i){"use strict";const r=t("./constants"),s=t("./shader"),_=t("./uniforms");class E{constructor(t,e,i,E,a){let h,S,n,T=!1,R=!1;"string"==typeof i?(S=new s(t,t.VERTEX_SHADER,i),T=!0):S=i,"string"==typeof E?(n=new s(t,t.FRAGMENT_SHADER,E),R=!0):n=E;let A=t.createProgram();t.attachShader(A,S.shader),t.attachShader(A,n.shader),a&&t.transformFeedbackVaryings(A,a,t.SEPARATE_ATTRIBS),t.linkProgram(A),t.getProgramParameter(A,t.LINK_STATUS)||console.error(t.getProgramInfoLog(A)),T&&S.delete(),R&&n.delete(),this.gl=t,this.program=A,this.appState=e,this.transformFeedback=!!a,this.uniforms={},this.uniformBlocks={},this.uniformBlockBindings={},this.samplers={},this.samplerCount=1,t.useProgram(A);let l=t.getProgramParameter(A,t.ACTIVE_UNIFORMS);for(h=0;h<l;++h){let e=t.getActiveUniform(A,h),i=t.getUniformLocation(this.program,e.name),s=null,E=e.type,a=e.size;switch(E){case r.SAMPLER_2D:case r.INT_SAMPLER_2D:case r.UNSIGNED_INT_SAMPLER_2D:case r.SAMPLER_2D_SHADOW:case r.SAMPLER_2D_ARRAY:case r.INT_SAMPLER_2D_ARRAY:case r.UNSIGNED_INT_SAMPLER_2D_ARRAY:case r.SAMPLER_2D_ARRAY_SHADOW:case r.SAMPLER_CUBE:case r.INT_SAMPLER_CUBE:case r.UNSIGNED_INT_SAMPLER_CUBE:case r.SAMPLER_CUBE_SHADOW:case r.SAMPLER_3D:case r.INT_SAMPLER_3D:case r.UNSIGNED_INT_SAMPLER_3D:let t=this.samplerCount++;this.samplers[e.name]=t,this.gl.uniform1i(i,t);break;case r.INT:case r.UNSIGNED_INT:case r.FLOAT:s=a>1?_.MultiNumericUniform:_.SingleComponentUniform;break;case r.BOOL:s=a>1?_.MultiBoolUniform:_.SingleComponentUniform;break;case r.FLOAT_VEC2:case r.INT_VEC2:case r.UNSIGNED_INT_VEC2:case r.FLOAT_VEC3:case r.INT_VEC3:case r.UNSIGNED_INT_VEC3:case r.FLOAT_VEC4:case r.INT_VEC4:case r.UNSIGNED_INT_VEC4:s=_.MultiNumericUniform;break;case r.BOOL_VEC2:case r.BOOL_VEC3:case r.BOOL_VEC4:s=_.MultiBoolUniform;break;case r.FLOAT_MAT2:case r.FLOAT_MAT3:case r.FLOAT_MAT4:case r.FLOAT_MAT2x3:case r.FLOAT_MAT2x4:case r.FLOAT_MAT3x2:case r.FLOAT_MAT3x4:case r.FLOAT_MAT4x2:case r.FLOAT_MAT4x3:s=_.MatrixUniform;break;default:console.error("Unrecognized type for uniform ",e.name)}s&&(this.uniforms[e.name]=new s(t,i,E,a))}let u=t.getProgramParameter(A,t.ACTIVE_UNIFORM_BLOCKS);for(h=0;h<u;++h){let e=t.getActiveUniformBlockName(this.program,h),i=t.getUniformBlockIndex(this.program,e);this.uniformBlocks[e]=i}t.useProgram(null)}delete(){this.program&&(this.gl.deleteProgram(this.program),this.program=null)}uniform(t,e){this.uniforms[t].set(e)}uniformBlock(t,e){this.uniformBlockBindings[t]!==e&&(this.gl.uniformBlockBinding(this.program,this.uniformBlocks[t],e),this.uniformBlockBindings[t]=e)}bind(){this.appState.program!==this&&(this.gl.useProgram(this.program),this.appState.program=this)}}e.exports=E},{"./constants":2,"./shader":9,"./uniforms":15}],8:[function(t,e,i){"use strict";class r{constructor(t,e){this.gl=t,this.query=t.createQuery(),this.target=e,this.active=!1,this.result=null}begin(){this.active||(this.gl.beginQuery(this.target,this.query),this.result=null)}end(){this.active||(this.gl.endQuery(this.target),this.active=!0)}ready(){return!(!this.active||!this.gl.getQueryParameter(this.query,this.gl.QUERY_RESULT_AVAILABLE))&&(this.active=!1,this.result=this.gl.getQueryParameter(this.query,this.gl.QUERY_RESULT),!0)}}e.exports=r},{}],9:[function(t,e,i){"use strict";class r{constructor(t,e,i){if(this.gl=t,this.shader=t.createShader(e),t.shaderSource(this.shader,i),t.compileShader(this.shader),!t.getShaderParameter(this.shader,t.COMPILE_STATUS)){let e,r;for(console.error(t.getShaderInfoLog(this.shader)),r=i.split("\n"),e=0;e<r.length;++e)console.error(e+1+":",r[e])}}delete(){this.shader&&(this.gl.deleteShader(this.shader),this.shader=null)}}e.exports=r},{}],10:[function(t,e,i){"use strict";const r=t("./constants"),s={},_=s[r.UNSIGNED_BYTE]={};_[r.RED]=r.R8,_[r.RG]=r.RG8,_[r.RGB]=r.RGB8,_[r.RGBA]=r.RGBA8,(s[r.UNSIGNED_SHORT]={})[r.DEPTH_COMPONENT]=r.DEPTH_COMPONENT16;const E=s[r.FLOAT]={};E[r.RED]=r.R16F,E[r.RG]=r.RG16F,E[r.RGB]=r.RGB16F,E[r.RGBA]=r.RGBA16F,E[r.DEPTH_COMPONENT]=r.DEPTH_COMPONENT32F,s.COMPRESSED_TYPES={},s.NO_TEX_STORAGE={},e.exports=s},{"./constants":2}],11:[function(t,e,i){"use strict";const r=t("./constants"),s=t("./texture-format-defaults"),_=new Array(1);class E{constructor(t,e,i,_,E=_.width,a=_.height,h,S,n=r.DUMMY_OBJECT){this.gl=t,this.binding=i,this.texture=null,this.width=-1,this.height=-1,this.depth=-1,this.type=void 0!==n.type?n.type:t.UNSIGNED_BYTE,this.is3D=S,this.appState=e,this.format=null,this.internalFormat=null,this.compressed=!(!s.COMPRESSED_TYPES[n.format]&&!s.COMPRESSED_TYPES[n.internalFormat]),this.compressed?(this.format=void 0!==n.format?n.format:n.internalFormat,this.internalFormat=void 0!==n.internalFormat?n.internalFormat:n.format):(this.format=void 0!==n.format?n.format:t.RGBA,this.internalFormat=void 0!==n.internalFormat?n.internalFormat:s[this.type][this.format]),this.noTexStorage=!!s.NO_TEX_STORAGE[this.internalFormat],this.currentUnit=-1;let T=void 0!==n.minFilter?n.minFilter:t.LINEAR_MIPMAP_NEAREST,R=void 0!==n.magFilter?n.magFilter:t.LINEAR,A=void 0!==n.wrapS?n.wrapS:t.REPEAT,l=void 0!==n.wrapT?n.wrapT:t.REPEAT,u=void 0!==n.wrapR?n.wrapR:t.REPEAT,o=void 0!==n.compareMode?n.compareMode:t.NONE,f=void 0!==n.compareFunc?n.compareFunc:t.LEQUAL,C=void 0!==n.minLOD?n.minLOD:null,P=void 0!==n.maxLOD?n.maxLOD:null;this.sampler=t.createSampler(),t.samplerParameteri(this.sampler,t.TEXTURE_MIN_FILTER,T),t.samplerParameteri(this.sampler,t.TEXTURE_MAG_FILTER,R),t.samplerParameteri(this.sampler,t.TEXTURE_WRAP_S,A),t.samplerParameteri(this.sampler,t.TEXTURE_WRAP_T,l),t.samplerParameteri(this.sampler,t.TEXTURE_WRAP_R,u),t.samplerParameteri(this.sampler,t.TEXTURE_COMPARE_FUNC,f),t.samplerParameteri(this.sampler,t.TEXTURE_COMPARE_MODE,o),null!==C&&t.samplerParameterf(this.sampler,t.TEXTURE_MIN_LOD,C),null!==P&&t.samplerParameterf(this.sampler,t.TEXTURE_MAX_LOD,P),this.flipY=void 0!==n.flipY&&n.flipY,this.baseLevel=void 0!==n.baseLevel?n.baseLevel:null,this.maxLevel=void 0!==n.maxLevel?n.maxLevel:null,this.mipmaps=T===t.LINEAR_MIPMAP_NEAREST||T===t.LINEAR_MIPMAP_LINEAR,this.resize(E,a,h),_&&this.data(_)}resize(t,e,i){if(i=i||0,t===this.width&&e===this.height&&i===this.depth)return;if(this.gl.deleteTexture(this.texture),-1!==this.currentUnit&&(this.appState.textures[this.currentUnit]=null),this.texture=this.gl.createTexture(),this.bind(Math.max(this.currentUnit,1)),this.width=t,this.height=e,this.depth=i,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),null!==this.baseLevel&&this.gl.texParameteri(this.binding,this.gl.TEXTURE_BASE_LEVEL,this.baseLevel),null!==this.maxLevel&&this.gl.texParameteri(this.binding,this.gl.TEXTURE_MAX_LEVEL,this.maxLevel),this.noTexStorage)return;let r;this.is3D?(r=this.mipmaps?Math.floor(Math.log2(Math.max(Math.max(this.width,this.height),this.depth)))+1:1,this.gl.texStorage3D(this.binding,r,this.internalFormat,this.width,this.height,this.depth)):(r=this.mipmaps?Math.floor(Math.log2(Math.max(this.width,this.height)))+1:1,this.gl.texStorage2D(this.binding,r,this.internalFormat,this.width,this.height))}data(t){Array.isArray(t)||(_[0]=t,t=_);let e,i=this.mipmaps?t.length:1,r=this.width,s=this.height,E=this.depth,a=this.mipmaps&&1===t.length;if(this.bind(Math.max(this.currentUnit,0)),this.compressed)if(this.noTexStorage)if(this.is3D)for(e=0;e<i;++e)this.gl.compressedTexImage3D(this.binding,e,this.internalFormat,r,s,E,0,t[e]),r=Math.max(r>>1,1),s=Math.max(s>>1,1),E=Math.max(E>>1,1);else for(e=0;e<i;++e)this.gl.compressedTexImage2D(this.binding,e,this.internalFormat,r,s,0,t[e]),r=Math.max(r>>1,1),s=Math.max(s>>1,1);else if(this.is3D)for(e=0;e<i;++e)this.gl.compressedTexSubImage3D(this.binding,e,0,0,0,r,s,E,this.format,t[e]),r=Math.max(r>>1,1),s=Math.max(s>>1,1),E=Math.max(E>>1,1);else for(e=0;e<i;++e)this.gl.compressedTexSubImage2D(this.binding,e,0,0,r,s,this.format,t[e]),r=Math.max(r>>1,1),s=Math.max(s>>1,1);else if(this.is3D)for(e=0;e<i;++e)this.gl.texSubImage3D(this.binding,e,0,0,0,r,s,E,this.format,this.type,t[e]),r=Math.max(r>>1,1),s=Math.max(s>>1,1),E=Math.max(E>>1,1);else for(e=0;e<i;++e)this.gl.texSubImage2D(this.binding,e,0,0,r,s,this.format,this.type,t[e]),r=Math.max(r>>1,1),s=Math.max(s>>1,1);return a&&this.gl.generateMipmap(this.binding),this}delete(){this.texture&&(this.gl.deleteTexture(this.texture),this.gl.deleteSampler(this.sampler),this.texture=null,this.sampler=null,this.appState.textures[this.currentUnit]=null,this.currentUnit=-1)}bind(t){let e=this.appState.textures[t];return e!==this&&(e&&(e.currentUnit=-1),-1!==this.currentUnit&&(this.appState.textures[this.currentUnit]=null),this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.binding,this.texture),this.gl.bindSampler(t,this.sampler),this.appState.textures[t]=this,this.currentUnit=t),this}}e.exports=E},{"./constants":2,"./texture-format-defaults":10}],12:[function(t,e,i){"use strict";const r=t("./query");class s{constructor(t){this.gl=t,this.cpuTimer=window.performance||window.Date;var e=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")||this.gl.getExtension("EXT_disjoint_timer_query");e?(this.gpuTimer=!0,this.gpuTimerQuery=new r(this.gl,e.TIME_ELAPSED_EXT),this.GPU_DISJOINT_EXT=e.GPU_DISJOINT_EXT):(this.gpuTimer=!1,this.gpuTimerQuery=null,this.GPU_DISJOINT_EXT=null),this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0}start(){this.gpuTimer?this.gpuTimerQuery.active||(this.gpuTimerQuery.begin(),this.cpuStartTime=this.cpuTimer.now()):this.cpuStartTime=this.cpuTimer.now()}end(){this.gpuTimer?this.gpuTimerQuery.active||(this.gpuTimerQuery.end(),this.cpuTime=this.cpuTimer.now()-this.cpuStartTime):this.cpuTime=this.cpuTimer.now()-this.cpuStartTime}ready(){if(this.gpuTimer){if(!this.gpuTimerQuery.active)return!1;var t=this.gpuTimerQuery.ready(),e=this.gl.getParameter(this.GPU_DISJOINT_EXT);return!(!t||e)&&(this.gpuTime=this.gpuTimerQuery.result/1e6,!0)}return!!this.cpuStartTime}}e.exports=s},{"./query":8}],13:[function(t,e,i){"use strict";class r{constructor(t,e){this.gl=t,this.transformFeedback=t.createTransformFeedback(),this.appState=e,this.angleBugBuffers=[]}feedbackBuffer(t,e){return this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,this.transformFeedback),this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,t,e.buffer),this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null),this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,t,null),this.angleBugBuffers[t]=e,this}delete(){this.transformFeedback&&(this.gl.deleteTransformFeedback(this.transformFeedback),this.transformFeedback=null)}bind(){if(this.appState.transformFeedback!==this){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,this.transformFeedback);for(let t=0,e=this.angleBugBuffers.length;t<e;++t)this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,t,this.angleBugBuffers[t].buffer);this.appState.transformFeedback=this}return this}}e.exports=r},{}],14:[function(t,e,i){"use strict";const r=t("./constants");class s{constructor(t,e,i=t.DYNAMIC_DRAW){this.gl=t,this.buffer=t.createBuffer(),this.dataViews={},this.offsets=new Array(e.length),this.sizes=new Array(e.length),this.types=new Array(e.length),this.size=0,this.usage=i;for(let t=0,i=e.length;t<i;++t){let i=e[t];switch(i){case r.FLOAT:case r.INT:case r.UNSIGNED_INT:case r.BOOL:this.offsets[t]=this.size,this.sizes[t]=1,i===r.INT?this.types[t]=r.INT:this.type===r.UNSIGNED_INT?this.types[t]=r.UNSIGNED_INT:this.types[t]=r.FLOAT,this.size++;break;case r.FLOAT_VEC2:case r.INT_VEC2:case r.UNSIGNED_INT_VEC2:case r.BOOL_VEC2:this.size+=this.size%2,this.offsets[t]=this.size,this.sizes[t]=2,i===r.INT_VEC2?this.types[t]=r.INT:this.type===r.UNSIGNED_INT_VEC2?this.types[t]=r.UNSIGNED_INT:this.types[t]=r.FLOAT,this.size+=2;break;case r.FLOAT_VEC3:case r.INT_VEC3:case r.UNSIGNED_INT_VEC3:case r.BOOL_VEC3:case r.FLOAT_VEC4:case r.INT_VEC4:case r.UNSIGNED_INT_VEC4:case r.BOOL_VEC4:this.size+=(4-this.size%4)%4,this.offsets[t]=this.size,this.sizes[t]=4,i===r.INT_VEC4||i===r.INT_VEC3?this.types[t]=r.INT:this.type===r.UNSIGNED_INT_VEC4||this.type===r.UNSIGNED_INT_VEC3?this.types[t]=r.UNSIGNED_INT:this.types[t]=r.FLOAT,this.size+=4;break;case r.FLOAT_MAT2:case r.FLOAT_MAT2x3:case r.FLOAT_MAT2x4:this.size+=(4-this.size%4)%4,this.offsets[t]=this.size,this.sizes[t]=8,this.types[t]=r.FLOAT,this.size+=8;break;case r.FLOAT_MAT3:case r.FLOAT_MAT3x2:case r.FLOAT_MAT3x4:this.size+=(4-this.size%4)%4,this.offsets[t]=this.size,this.sizes[t]=12,this.types[t]=r.FLOAT,this.size+=12;break;case r.FLOAT_MAT4:case r.FLOAT_MAT4x2:case r.FLOAT_MAT4x3:this.size+=(4-this.size%4)%4,this.offsets[t]=this.size,this.sizes[t]=16,this.types[t]=r.FLOAT,this.size+=16;break;default:console.error("Unsupported type for uniform buffer.")}}this.size+=(4-this.size%4)%4,this.data=new Float32Array(this.size),this.dataViews[r.FLOAT]=this.data,this.dataViews[r.INT]=new Int32Array(this.data.buffer),this.dataViews[r.UNSIGNED_INT]=new Uint32Array(this.data.buffer),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,0,this.buffer),this.gl.bufferData(this.gl.UNIFORM_BUFFER,4*this.size,this.usage),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,0,null)}set(t,e){let i=this.dataViews[this.types[t]];return 1===this.sizes[t]?i[this.offsets[t]]=e:i.set(e,this.offsets[t]),this}update(t){let e,i;if(void 0===t)e=this.data,i=0;else{let r=this.offsets[t],s=r+this.sizes[t];e=this.data.subarray(r,s),i=4*r}return this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,0,this.buffer),this.gl.bufferSubData(this.gl.UNIFORM_BUFFER,i,e),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,0,null),this}delete(){this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null)}bind(t){return this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,t,this.buffer),this}}e.exports=s},{"./constants":2}],15:[function(t,e,i){"use strict";const r=t("./constants"),s={};s[r.BOOL]="uniform1i",s[r.INT]="uniform1i",s[r.SAMPLER_2D]="uniform1i",s[r.INT_SAMPLER_2D]="uniform1i",s[r.UNSIGNED_INT_SAMPLER_2D]="uniform1i",s[r.SAMPLER_2D_SHADOW]="uniform1i",s[r.SAMPLER_2D_ARRAY]="uniform1i",s[r.INT_SAMPLER_2D_ARRAY]="uniform1i",s[r.UNSIGNED_INT_SAMPLER_2D_ARRAY]="uniform1i",s[r.SAMPLER_2D_ARRAY_SHADOW]="uniform1i",s[r.SAMPLER_CUBE]="uniform1i",s[r.INT_SAMPLER_CUBE]="uniform1i",s[r.UNSIGNED_INT_SAMPLER_CUBE]="uniform1i",s[r.SAMPLER_CUBE_SHADOW]="uniform1i",s[r.SAMPLER_3D]="uniform1i",s[r.INT_SAMPLER_3D]="uniform1i",s[r.UNSIGNED_INT_SAMPLER_3D]="uniform1i",s[r.UNSIGNED_INT]="uniform1ui",s[r.FLOAT]="uniform1f",s[r.FLOAT_VEC2]="uniform2f",s[r.FLOAT_VEC3]="uniform3f",s[r.FLOAT_VEC4]="uniform4f",s[r.INT_VEC2]="uniform2i",s[r.INT_VEC3]="uniform3i",s[r.INT_VEC4]="uniform4i",s[r.UNSIGNED_INT_VEC2]="uniform2ui",s[r.UNSIGNED_INT_VEC3]="uniform3ui",s[r.UNSIGNED_INT_VEC4]="uniform4ui",s[r.BOOL_VEC2]="uniform2i",s[r.BOOL_VEC3]="uniform3i",s[r.BOOL_VEC4]="uniform4i",s[r.FLOAT_MAT2]="uniformMatrix2fv",s[r.FLOAT_MAT3]="uniformMatrix3fv",s[r.FLOAT_MAT4]="uniformMatrix4fv",s[r.FLOAT_MAT2x3]="uniformMatrix2x3fv",s[r.FLOAT_MAT2x4]="uniformMatrix2x4fv",s[r.FLOAT_MAT3x2]="uniformMatrix3x2fv",s[r.FLOAT_MAT3x4]="uniformMatrix3x4fv",s[r.FLOAT_MAT4x2]="uniformMatrix4x2fv",s[r.FLOAT_MAT4x3]="uniformMatrix4x3fv";const _={};_[r.BOOL]=1,_[r.INT]=1,_[r.SAMPLER_2D]=1,_[r.INT_SAMPLER_2D]=1,_[r.UNSIGNED_INT_SAMPLER_2D]=1,_[r.SAMPLER_2D_SHADOW]=1,_[r.SAMPLER_2D_ARRAY]=1,_[r.INT_SAMPLER_2D_ARRAY]=1,_[r.UNSIGNED_INT_SAMPLER_2D_ARRAY]=1,_[r.SAMPLER_2D_ARRAY_SHADOW]=1,_[r.SAMPLER_CUBE]=1,_[r.INT_SAMPLER_CUBE]=1,_[r.UNSIGNED_INT_SAMPLER_CUBE]=1,_[r.SAMPLER_CUBE_SHADOW]=1,_[r.SAMPLER_3D]=1,_[r.INT_SAMPLER_3D]=1,_[r.UNSIGNED_INT_SAMPLER_3D]=1,_[r.UNSIGNED_INT]=1,_[r.FLOAT]=1,_[r.FLOAT_VEC2]=2,_[r.FLOAT_VEC3]=3,_[r.FLOAT_VEC4]=4,_[r.INT_VEC2]=2,_[r.INT_VEC3]=3,_[r.INT_VEC4]=4,_[r.UNSIGNED_INT_VEC2]=2,_[r.UNSIGNED_INT_VEC3]=3,_[r.UNSIGNED_INT_VEC4]=4,_[r.BOOL_VEC2]=2,_[r.BOOL_VEC3]=3,_[r.BOOL_VEC4]=4,_[r.FLOAT_MAT2]=4,_[r.FLOAT_MAT3]=9,_[r.FLOAT_MAT4]=16,_[r.FLOAT_MAT2x3]=6,_[r.FLOAT_MAT2x4]=8,_[r.FLOAT_MAT3x2]=6,_[r.FLOAT_MAT3x4]=12,_[r.FLOAT_MAT4x2]=8,_[r.FLOAT_MAT4x3]=12;const E={};E[r.INT]=Int32Array,E[r.SAMPLER_2D]=Int32Array,E[r.INT_SAMPLER_2D]=Int32Array,E[r.UNSIGNED_INT_SAMPLER_2D]=Int32Array,E[r.SAMPLER_2D_SHADOW]=Int32Array,E[r.SAMPLER_2D_ARRAY]=Int32Array,E[r.INT_SAMPLER_2D_ARRAY]=Int32Array,E[r.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Int32Array,E[r.SAMPLER_2D_ARRAY_SHADOW]=Int32Array,E[r.SAMPLER_CUBE]=Int32Array,E[r.INT_SAMPLER_CUBE]=Int32Array,E[r.UNSIGNED_INT_SAMPLER_CUBE]=Int32Array,E[r.SAMPLER_CUBE_SHADOW]=Int32Array,E[r.SAMPLER_3D]=Int32Array,E[r.INT_SAMPLER_3D]=Int32Array,E[r.UNSIGNED_INT_SAMPLER_3D]=Int32Array,E[r.UNSIGNED_INT]=Uint32Array,E[r.FLOAT]=Float32Array,E[r.FLOAT_VEC2]=Float32Array,E[r.FLOAT_VEC3]=Float32Array,E[r.FLOAT_VEC4]=Float32Array,E[r.INT_VEC2]=Int32Array,E[r.INT_VEC3]=Int32Array,E[r.INT_VEC4]=Int32Array,E[r.UNSIGNED_INT_VEC2]=Uint32Array,E[r.UNSIGNED_INT_VEC3]=Uint32Array,E[r.UNSIGNED_INT_VEC4]=Uint32Array;class a{constructor(t,e,i){this.gl=t,this.handle=e,this.glFuncName=s[i],this.cache=i!==r.BOOL&&0}set(t){this.cache!==t&&(this.gl[this.glFuncName](this.handle,t),this.cache=t)}}class h{constructor(t,e,i,r){this.gl=t,this.handle=e,this.glFuncName=s[i]+"v",this.count=r,this.cache=new E[i](_[i]*r)}set(t){for(let e=0,i=t.length;e<i;++e)if(this.cache[e]!==t[e])return this.gl[this.glFuncName](this.handle,t),void this.cache.set(t)}}class S{constructor(t,e,i,r){this.gl=t,this.handle=e,this.glFuncName=s[i]+"v",this.count=r,this.cache=new Array(_[i]*r).fill(!1)}set(t){for(let e=0,i=t.length;e<i;++e)if(this.cache[e]!==t[e]){this.gl[this.glFuncName](this.handle,t);for(let r=e;r<i;r++)this.cache[r]=t[r];return}}}class n{constructor(t,e,i,r){this.gl=t,this.handle=e,this.glFuncName=s[i],this.count=r,this.cache=new Float32Array(_[i]*r)}set(t){for(let e=0,i=t.length;e<i;++e)if(this.cache[e]!==t[e])return this.gl[this.glFuncName](this.handle,!1,t),void this.cache.set(t)}}e.exports.MatrixUniform=n,e.exports.MultiBoolUniform=S,e.exports.MultiNumericUniform=h,e.exports.SingleComponentUniform=a},{"./constants":2}],16:[function(t,e,i){"use strict";const r=t("./constants");class s{constructor(t,e){this.gl=t,this.vertexArray=t.createVertexArray(),this.appState=e,this.numElements=0,this.indexType=null,this.instancedBuffers=0,this.indexed=!1,this.numInstances=0}vertexAttributeBuffer(t,e){return this.attributeBuffer(t,e,!1,!1,!1),this}instanceAttributeBuffer(t,e){return this.attributeBuffer(t,e,!0,!1,!1),this}vertexIntegerAttributeBuffer(t,e){return this.attributeBuffer(t,e,!1,!0,!1),this}instanceIntegerAttributeBuffer(t,e){return this.attributeBuffer(t,e,!0,!0,!1),this}vertexNormalizedAttributeBuffer(t,e){return this.attributeBuffer(t,e,!1,!1,!0),this}instanceNormalizedAttributeBuffer(t,e){return this.attributeBuffer(t,e,!0,!1,!0),this}indexBuffer(t){return this.gl.bindVertexArray(this.vertexArray),this.gl.bindBuffer(t.binding,t.buffer),this.numElements=3*t.numItems,this.indexType=t.type,this.indexed=!0,this.gl.bindVertexArray(null),this.gl.bindBuffer(t.binding,null),this}delete(){return this.vertexArray&&(this.gl.deleteVertexArray(this.vertexArray),this.vertexArray=null),this.gl.bindVertexArray(null),this}bind(){return this.appState.vertexArray!==this&&(this.gl.bindVertexArray(this.vertexArray),this.appState.vertexArray=this),this}attributeBuffer(t,e,i,s,_){this.gl.bindVertexArray(this.vertexArray),this.gl.bindBuffer(e.binding,e.buffer);let E=e.numColumns;for(let a=0;a<E;++a)s?this.gl.vertexAttribIPointer(t+a,e.itemSize,e.type,E*e.itemSize*r.TYPE_SIZE[e.type],a*e.itemSize*r.TYPE_SIZE[e.type]):this.gl.vertexAttribPointer(t+a,e.itemSize,e.type,_,E*e.itemSize*r.TYPE_SIZE[e.type],a*e.itemSize*r.TYPE_SIZE[e.type]),i&&this.gl.vertexAttribDivisor(t+a,1),this.gl.enableVertexAttribArray(t+a);return this.instanced=this.instanced||i,i?this.numInstances=e.numItems:this.numElements=this.numElements||e.numItems,this.gl.bindVertexArray(null),this.gl.bindBuffer(e.binding,null),this}}e.exports=s},{"./constants":2}],17:[function(t,e,i){"use strict";const r=t("./constants");class s{constructor(t,e,i,s,_,E=t.STATIC_DRAW,a){let h;switch(i){case r.FLOAT_MAT4:case r.FLOAT_MAT4x2:case r.FLOAT_MAT4x3:h=4;break;case r.FLOAT_MAT3:case r.FLOAT_MAT3x2:case r.FLOAT_MAT3x4:h=3;break;case r.FLOAT_MAT2:case r.FLOAT_MAT2x3:case r.FLOAT_MAT2x4:h=2;break;default:h=1}switch(i){case r.FLOAT_MAT4:case r.FLOAT_MAT3x4:case r.FLOAT_MAT2x4:s=4,i=r.FLOAT;break;case r.FLOAT_MAT3:case r.FLOAT_MAT4x3:case r.FLOAT_MAT2x3:s=3,i=r.FLOAT;break;case r.FLOAT_MAT2:case r.FLOAT_MAT3x2:case r.FLOAT_MAT4x2:s=2,i=r.FLOAT}let S;"number"==typeof _?(S=_,_*=r.TYPE_SIZE[i]):S=_.length,this.gl=t,this.buffer=t.createBuffer(),this.appState=e,this.type=i,this.itemSize=s,this.numItems=S/(s*h),this.numColumns=h,this.usage=E,this.indexArray=!!a,this.binding=this.indexArray?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER,t.bindBuffer(this.binding,this.buffer),t.bufferData(this.binding,_,this.usage),t.bindBuffer(this.binding,null)}data(t){let e=this.appState.vertexArray;return e&&this.gl.bindVertexArray(null),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferSubData(this.binding,0,t),this.gl.bindBuffer(this.binding,null),e&&this.gl.bindVertexArray(e.vertexArray),this}delete(){this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null)}}e.exports=s},{"./constants":2}]},{},[6])(6)});
