/*
PicoGL.js v0.0.5 

The MIT License (MIT)

Copyright (c) 2017 Tarek Sherif

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
!function(){"use strict";var a=window.PicoGL={version:"0.0.5"};!function(){var b=document.createElement("canvas"),c=b.getContext("webgl")||b.getContext("experimental-webgl");if(c)for(var d in c)d.match(/^[A-Z_]+$/)&&"number"==typeof c[d]&&(a[d]=c[d])}(),a.DUMMY_OBJECT={},a.createApp=function(b,c){return new a.App(b,c)},a.compileShader=function(a,b,c,d){if(a.shaderSource(b,c),a.compileShader(b),d&&!a.getShaderParameter(b,a.COMPILE_STATUS)){var e,f;for(console.error(a.getShaderInfoLog(b)),f=c.split("\n"),e=0;e<f.length;++e)console.error(e+1+":",f[e])}}}(),function(){"use strict";PicoGL.App=function(a,b){this.canvas=a,this.gl=a.getContext("webgl2",b),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.currentDrawCalls=null,this.currentState={program:null},this.clearBits=this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT,this.gl.viewport(0,0,this.width,this.height),this.colorBufferFloatEnabled=!1,this.linearFloatTexturesEnabled=!1,this.debugEnabled=!1},PicoGL.App.prototype.clearMask=function(a){return this.clearBits=a,this},PicoGL.App.prototype.clearColor=function(a,b,c,d){return this.gl.clearColor(a,b,c,d),this},PicoGL.App.prototype.clear=function(){return this.gl.clear(this.clearBits),this},PicoGL.App.prototype.drawCalls=function(a){return this.currentDrawCalls=a,this},PicoGL.App.prototype.framebuffer=function(a){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.framebuffer),this.gl.viewport(0,0,a.width,a.height),this},PicoGL.App.prototype.defaultFramebuffer=function(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.width,this.height),this},PicoGL.App.prototype.depthRange=function(a,b){return this.gl.depthRange(a,b),this},PicoGL.App.prototype.depthTest=function(){return this.gl.enable(this.gl.DEPTH_TEST),this},PicoGL.App.prototype.noDepthTest=function(){return this.gl.disable(this.gl.DEPTH_TEST),this},PicoGL.App.prototype.depthMask=function(){return this.gl.depthMask(!0),this},PicoGL.App.prototype.noDepthMask=function(){return this.gl.depthMask(!1),this},PicoGL.App.prototype.blend=function(){return this.gl.enable(this.gl.BLEND),this},PicoGL.App.prototype.noBlend=function(){return this.gl.disable(this.gl.BLEND),this},PicoGL.App.prototype.depthFunc=function(a){return this.gl.depthFunc(a),this},PicoGL.App.prototype.blendFunc=function(a,b){return this.gl.blendFunc(a,b),this},PicoGL.App.prototype.blendFuncSeparate=function(a,b,c,d){return this.gl.blendFuncSeparate(a,b,c,d),this},PicoGL.App.prototype.cullBackfaces=function(){return this.gl.enable(this.gl.CULL_FACE),this},PicoGL.App.prototype.drawBackfaces=function(){return this.gl.disable(this.gl.CULL_FACE),this},PicoGL.App.prototype.depthTextures=function(){return this.depthTexturesEnabled=!!this.gl.getExtension("WEBGL_depth_texture"),this.depthTexturesEnabled||console.warn("Extension WEBGL_depth_texture unavailable. Cannot enable depth textures."),this},PicoGL.App.prototype.renderToFloat=function(){return this.colorBufferFloatEnabled=!!this.gl.getExtension("EXT_color_buffer_float"),this.colorBufferFloatEnabled||console.warn("Extension EXT_color_buffer_float unavailable. Cannot enable float textures."),this},PicoGL.App.prototype.linearFloatTextures=function(){return this.linearFloatTexturesEnabled=!!this.gl.getExtension("OES_texture_float_linear"),this.linearFloatTexturesEnabled||console.warn("Extension OES_texture_float_linear unavailable. Cannot enable float texture linear filtering."),this},PicoGL.App.prototype.readPixel=function(a,b,c){return this.gl.readPixels(a,b,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,c),this},PicoGL.App.prototype.resize=function(a,b){return this.canvas.width=a,this.canvas.height=b,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.gl.viewport(0,0,this.width,this.height),this},PicoGL.App.prototype.debug=function(){return this.debugEnabled=!0,this},PicoGL.App.prototype.createProgram=function(a,b){return new PicoGL.Program(this.gl,a,b,this.debugEnabled)},PicoGL.App.prototype.createShader=function(a,b){var c=this.gl.createShader(a);return PicoGL.compileShader(this.gl,c,b,this.debugEnabled),c},PicoGL.App.prototype.createVertexArray=function(){return new PicoGL.VertexArray(this.gl)},PicoGL.App.prototype.createArrayBuffer=function(a,b,c){return new PicoGL.ArrayBuffer(this.gl,a,b,c)},PicoGL.App.prototype.createUniformBuffer=function(a){return new PicoGL.UniformBuffer(this.gl,a)},PicoGL.App.prototype.createIndexBuffer=function(a,b,c){return new PicoGL.ArrayBuffer(this.gl,a,b,c,!0)},PicoGL.App.prototype.createTexture=function(a,b){return new PicoGL.Texture(this.gl,a,b)},PicoGL.App.prototype.createCubemap=function(a){return new PicoGL.Cubemap(this.gl,a)},PicoGL.App.prototype.createFramebuffer=function(a,b,c,d){return new PicoGL.Framebuffer(this.gl,this.drawBuffersExtension,a,b,this.depthTexturesEnabled,c,d)},PicoGL.App.prototype.createDrawCall=function(a,b){return new PicoGL.DrawCall(this.gl,a,b)},PicoGL.App.prototype.draw=function(){for(var a=0,b=this.currentDrawCalls.length;a<b;a++)this.currentDrawCalls[a].draw(this.currentState);return this}}(),function(){"use strict";PicoGL.Program=function(a,b,c,d){var e,f,g;"string"==typeof b?(f=a.createShader(a.VERTEX_SHADER),PicoGL.compileShader(a,f,b,d)):f=b,"string"==typeof c?(g=a.createShader(a.FRAGMENT_SHADER),PicoGL.compileShader(a,g,c,d)):g=c;var h=a.createProgram();a.attachShader(h,f),a.attachShader(h,g),a.linkProgram(h),d&&!a.getProgramParameter(h,a.LINK_STATUS)&&console.error(a.getProgramInfoLog(h)),this.gl=a,this.program=h,this.uniforms={},this.uniformBlocks={};var i=a.getProgramParameter(h,a.ACTIVE_UNIFORMS);for(e=0;e<i;++e){var j=a.getActiveUniform(h,e),k=a.getUniformLocation(this.program,j.name),l=null;switch(j.type){case a.INT:case a.BOOL:case a.SAMPLER_2D:case a.SAMPLER_CUBE:l=PicoGL.IntUniform;break;case a.FLOAT:l=PicoGL.FloatUniform;break;case a.FLOAT_VEC2:l=PicoGL.Vec2Uniform;break;case a.FLOAT_VEC3:l=PicoGL.Vec3Uniform;break;case a.FLOAT_VEC4:l=PicoGL.Vec4Uniform;break;case a.INT_VEC2:l=PicoGL.IntVec2Uniform;break;case a.INT_VEC3:l=PicoGL.IntVec3Uniform;break;case a.INT_VEC4:l=PicoGL.IntVec4Uniform;break;case a.BOOL_VEC2:l=PicoGL.BoolVec2Uniform;break;case a.BOOL_VEC3:l=PicoGL.BoolVec3Uniform;break;case a.BOOL_VEC4:l=PicoGL.BoolVec4Uniform;break;case a.FLOAT_MAT2:l=PicoGL.Mat2Uniform;break;case a.FLOAT_MAT3:l=PicoGL.Mat3Uniform;break;case a.FLOAT_MAT4:l=PicoGL.Mat4Uniform;break;default:console.error("Unrecognized type for uniform ",j.name)}this.uniforms[j.name]=new l(a,k)}var m=a.getProgramParameter(h,a.ACTIVE_UNIFORM_BLOCKS);for(e=0;e<m;++e){var n=a.getActiveUniformBlockName(this.program,e),o=a.getUniformBlockIndex(this.program,n);this.uniformBlocks[n]=o}},PicoGL.Program.prototype.uniform=function(a,b){this.uniforms[a].set(b)},PicoGL.Program.prototype.uniformBlock=function(a,b){this.gl.uniformBlockBinding(this.program,this.uniformBlocks[a],b)}}(),function(){"use strict";PicoGL.VertexArray=function(a){this.gl=a,this.vertexArray=a.createVertexArray(),this.numElements=0,this.indexType=null,this.indexed=!1},PicoGL.VertexArray.prototype.attributeBuffer=function(a,b){return a.bind(),this.gl.vertexAttribPointer(b,a.itemSize,a.type,!1,0,0),this.gl.enableVertexAttribArray(b),this.numElements=this.numElements||a.numItems,this},PicoGL.VertexArray.prototype.indexBuffer=function(a){return a.bind(),this.numElements=3*a.numItems,this.indexType=a.type,this.indexed=!0,this},PicoGL.VertexArray.prototype.bind=function(){return this.gl.bindVertexArray(this.vertexArray),this},PicoGL.VertexArray.prototype.unbind=function(){return this.gl.bindVertexArray(null),this}}(),function(){"use strict";PicoGL.ArrayBuffer=function(a,b,c,d,e){this.gl=a,this.buffer=a.createBuffer(),this.type=b,this.itemSize=c,this.numItems=d.length/c,this.indexArray=!!e,this.binding=this.indexArray?a.ELEMENT_ARRAY_BUFFER:a.ARRAY_BUFFER,a.bindBuffer(this.binding,this.buffer),a.bufferData(this.binding,d,a.STATIC_DRAW),a.bindBuffer(this.binding,null)},PicoGL.ArrayBuffer.prototype.bind=function(){return this.gl.bindBuffer(this.binding,this.buffer),this}}(),function(){"use strict";PicoGL.FloatUniform=function(a,b){this.gl=a,this.handle=b,this.cache=0},PicoGL.FloatUniform.prototype.set=function(a){this.cache!==a&&(this.gl.uniform1f(this.handle,a),this.cache=a)},PicoGL.IntUniform=function(a,b){this.gl=a,this.handle=b,this.cache=0},PicoGL.IntUniform.prototype.set=function(a){this.cache!==a&&(this.gl.uniform1i(this.handle,a),this.cache=a)},PicoGL.Vec2Uniform=function(a,b){this.gl=a,this.handle=b,this.cache=new Float32Array(2)},PicoGL.Vec2Uniform.prototype.set=function(a){this.cache[0]===a[0]&&this.cache[1]===a[1]||(this.gl.uniform2fv(this.handle,a),this.cache.set(a))},PicoGL.Vec3Uniform=function(a,b){this.gl=a,this.handle=b,this.cache=new Float32Array(3)},PicoGL.Vec3Uniform.prototype.set=function(a){this.cache[0]===a[0]&&this.cache[1]===a[1]&&this.cache[2]===a[2]||(this.gl.uniform3fv(this.handle,a),this.cache.set(a))},PicoGL.Vec4Uniform=function(a,b){this.gl=a,this.handle=b,this.cache=new Float32Array(4)},PicoGL.Vec4Uniform.prototype.set=function(a){this.cache[0]===a[0]&&this.cache[1]===a[1]&&this.cache[2]===a[2]&&this.cache[3]===a[3]||(this.gl.uniform4fv(this.handle,a),this.cache.set(a))},PicoGL.IntVec2Uniform=function(a,b){this.gl=a,this.handle=b,this.cache=new Int32Array(2)},PicoGL.IntVec2Uniform.prototype.set=function(a){this.cache[0]===a[0]&&this.cache[1]===a[1]||(this.gl.uniform2iv(this.handle,a),this.cache.set(a))},PicoGL.IntVec3Uniform=function(a,b){this.gl=a,this.handle=b,this.cache=new Int32Array(3)},PicoGL.IntVec3Uniform.prototype.set=function(a){this.cache[0]===a[0]&&this.cache[1]===a[1]&&this.cache[2]===a[2]||(this.gl.uniform3iv(this.handle,a),this.cache.set(a))},PicoGL.IntVec4Uniform=function(a,b){this.gl=a,this.handle=b,this.cache=new Int32Array(4)},PicoGL.IntVec4Uniform.prototype.set=function(a){this.cache[0]===a[0]&&this.cache[1]===a[1]&&this.cache[2]===a[2]&&this.cache[3]===a[3]||(this.gl.uniform4iv(this.handle,a),this.cache.set(a))},PicoGL.BoolVec2Uniform=function(a,b){this.gl=a,this.handle=b,this.cache=[!1,!1]},PicoGL.BoolVec2Uniform.prototype.set=function(a){this.cache[0]===a[0]&&this.cache[1]===a[1]||(this.gl.uniform2iv(this.handle,a),this.cache[0]=a[0],this.cache[1]=a[1])},PicoGL.BoolVec3Uniform=function(a,b){this.gl=a,this.handle=b,this.cache=[!1,!1,!1]},PicoGL.BoolVec3Uniform.prototype.set=function(a){this.cache[0]===a[0]&&this.cache[1]===a[1]&&this.cache[2]===a[2]||(this.gl.uniform3iv(this.handle,a),this.cache[0]=a[0],this.cache[1]=a[1],this.cache[2]=a[2])},PicoGL.BoolVec4Uniform=function(a,b){this.gl=a,this.handle=b,this.cache=[!1,!1,!1,!1]},PicoGL.BoolVec4Uniform.prototype.set=function(a){this.cache[0]===a[0]&&this.cache[1]===a[1]&&this.cache[2]===a[2]&&this.cache[3]===a[3]||(this.gl.uniform4iv(this.handle,a),this.cache[0]=a[0],this.cache[1]=a[1],this.cache[2]=a[2],this.cache[3]=a[3])},PicoGL.Mat2Uniform=function(a,b){this.gl=a,this.handle=b,this.cache=new Float32Array(4)},PicoGL.Mat2Uniform.prototype.set=function(a){this.cache[0]===a[0]&&this.cache[1]===a[1]&&this.cache[2]===a[2]&&this.cache[3]===a[3]||(this.gl.uniformMatrix2fv(this.handle,!1,a),this.cache.set(a))},PicoGL.Mat3Uniform=function(a,b){this.gl=a,this.handle=b,this.cache=new Float32Array(9)},PicoGL.Mat3Uniform.prototype.set=function(a){this.cache[0]===a[0]&&this.cache[1]===a[1]&&this.cache[2]===a[2]&&this.cache[3]===a[3]&&this.cache[4]===a[4]&&this.cache[5]===a[5]&&this.cache[6]===a[6]&&this.cache[7]===a[7]&&this.cache[8]===a[8]||(this.gl.uniformMatrix3fv(this.handle,!1,a),this.cache.set(a))},PicoGL.Mat4Uniform=function(a,b){this.gl=a,this.handle=b,this.cache=new Float32Array(16)},PicoGL.Mat4Uniform.prototype.set=function(a){this.cache[0]===a[0]&&this.cache[1]===a[1]&&this.cache[2]===a[2]&&this.cache[3]===a[3]&&this.cache[4]===a[4]&&this.cache[5]===a[5]&&this.cache[6]===a[6]&&this.cache[7]===a[7]&&this.cache[8]===a[8]&&this.cache[9]===a[9]&&this.cache[10]===a[10]&&this.cache[11]===a[11]&&this.cache[12]===a[12]&&this.cache[13]===a[13]&&this.cache[14]===a[14]&&this.cache[15]===a[15]||(this.gl.uniformMatrix4fv(this.handle,!1,a),this.cache.set(a))}}(),function(){"use strict";PicoGL.UniformBuffer=function(a,b){this.gl=a,this.buffer=a.createBuffer(),this.data=null,this.initValues={},this.offsets={},this.size=0,this.usage=b||a.STATIC_DRAW},PicoGL.UniformBuffer.prototype.vec4=function(a,b){return this.offsets[a]?this.data.set(b,this.offsets[a]):(this.size%4>0&&(this.size+=4-this.size%4),this.offsets[a]=this.size,this.initValues[a]=b,this.size+=4),this},PicoGL.UniformBuffer.prototype.mat4=function(a,b){return this.offsets[a]?this.data.set(b,this.offsets[a]):(this.size%4>0&&(this.size+=4-this.size%4),this.offsets[a]=this.size,this.initValues[a]=b,this.size+=16),this},PicoGL.UniformBuffer.prototype.update=function(){if(this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,this.buffer),this.data)this.gl.bufferSubData(this.gl.UNIFORM_BUFFER,0,this.data);else{this.size%4>0&&(this.size+=4-this.size%4),this.data=new Float32Array(this.size);for(var a in this.initValues)this.data.set(this.initValues[a],this.offsets[a]);this.initValues=null,this.gl.bufferData(this.gl.UNIFORM_BUFFER,this.data,this.usage)}return this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,null),this},PicoGL.UniformBuffer.prototype.bind=function(a){return this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,this.buffer),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,a,this.buffer),this}}(),function(){"use strict";PicoGL.Texture=function(a,b,c){c=c||PicoGL.DUMMY_OBJECT,this.gl=a,this.texture=a.createTexture(),this.internalFormat=c.internalFormat||a.RGBA,this.type=c.type||a.UNSIGNED_BYTE;var d=c.array||!1,e=c.width||0,f=c.height||0,g=void 0===c.flipY||c.flipY,h=c.minFilter||a.LINEAR_MIPMAP_NEAREST,i=c.magFilter||a.LINEAR,j=c.wrapS||a.REPEAT,k=c.wrapT||a.REPEAT,l=c.generateMipmaps!==!1&&(h===a.LINEAR_MIPMAP_NEAREST||h===a.LINEAR_MIPMAP_LINEAR);a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,g),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,h),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,j),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,k),d?a.texImage2D(a.TEXTURE_2D,0,this.internalFormat,e,f,0,this.internalFormat,this.type,b):a.texImage2D(a.TEXTURE_2D,0,this.internalFormat,this.internalFormat,this.type,b),l&&a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,null)},PicoGL.Texture.prototype.image=function(a,b,c){return this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),b&&c?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.internalFormat,b,c,0,this.internalFormat,this.type,a):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.internalFormat,this.internalFormat,this.type,a),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this},PicoGL.Texture.prototype.bind=function(a){return this.gl.activeTexture(a),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this}}(),function(){"use strict";PicoGL.Cubemap=function(a,b){this.gl=a,this.texture=a.createTexture(),b=b||PicoGL.DUMMY_OBJECT;var c=b.negX,d=b.posX,e=b.negY,f=b.posY,g=b.negZ,h=b.posZ,i=b.array||!1,j=b.width||0,k=b.height||0,l=void 0!==b.flipY&&b.flipY,m=b.minFilter||a.LINEAR_MIPMAP_NEAREST,n=b.magFilter||a.LINEAR,o=b.wrapS||a.REPEAT,p=b.wrapT||a.REPEAT,q=b.generateMipmaps!==!1&&(m===a.LINEAR_MIPMAP_NEAREST||m===a.LINEAR_MIPMAP_LINEAR),r=b.internalFormat||a.RGBA,s=b.type||a.UNSIGNED_BYTE;a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,l),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,n),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,m),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,o),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,p),i?(a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_X,0,r,j,k,0,r,s,c),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X,0,r,j,k,0,r,s,d),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,r,j,k,0,r,s,e),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Y,0,r,j,k,0,r,s,f),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,r,j,k,0,r,s,g),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Z,0,r,j,k,0,r,s,h)):(a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_X,0,r,r,s,c),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X,0,r,r,s,d),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,r,r,s,e),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Y,0,r,r,s,f),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,r,r,s,g),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Z,0,r,r,s,h)),q&&a.generateMipmap(a.TEXTURE_CUBE_MAP)},PicoGL.Cubemap.prototype.bind=function(a){this.gl.activeTexture(a),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.texture)}}(),function(){"use strict";PicoGL.Framebuffer=function(a,b,c,d,e,f,g){this.gl=a,this.framebuffer=a.createFramebuffer(),f&&g?(this.width=f,this.height=g):(this.width=a.drawingBufferWidth,this.height=a.drawingBufferHeight),this.drawBuffersExtension=b,this.numColorTargets=void 0!==c?c:1,b||(this.numColorTargets=1),this.colorTextures=new Array(this.numColorTargets),this.colorAttachments=new Array(this.numColorTargets),this.depthTexture=null,this.depthBuffer=null,a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer);for(var h=0;h<this.numColorTargets;++h)this.colorTextures[h]=new PicoGL.Texture(a,null,{array:!0,type:d||a.UNSIGNED_BYTE,width:this.width,height:this.height,minFilter:a.NEAREST,magFilter:a.NEAREST,wrapS:a.CLAMP_TO_EDGE,wrapT:a.CLAMP_TO_EDGE,generateMipmaps:!1}),this.drawBuffersExtension?this.colorAttachments[h]=this.drawBuffersExtension["COLOR_ATTACHMENT"+h+"_WEBGL"]:this.colorAttachments[h]=a.COLOR_ATTACHMENT0,a.framebufferTexture2D(a.FRAMEBUFFER,this.colorAttachments[h],a.TEXTURE_2D,this.colorTextures[h].texture,0);e?(this.depthTexture=new PicoGL.Texture(a,null,{array:!0,internalFormat:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT,width:this.width,height:this.height,minFilter:a.NEAREST,magFilter:a.NEAREST,wrapS:a.CLAMP_TO_EDGE,wrapT:a.CLAMP_TO_EDGE,generateMipmaps:!1}),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,this.depthTexture.texture,0)):(this.depthBuffer=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,this.depthBuffer),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this.width,this.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this.depthBuffer),a.bindRenderbuffer(a.RENDERBUFFER,null)),a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&console.log("Frame buffer error: "+a.checkFramebufferStatus(a.FRAMEBUFFER).toString()),this.drawBuffersExtension&&this.drawBuffersExtension.drawBuffersWEBGL(this.colorAttachments),a.bindFramebuffer(a.FRAMEBUFFER,null)},PicoGL.Framebuffer.prototype.colorTexture=function(a,b){b=b||0,this.colorTextures[b]=a,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer);for(var c=0;c<this.numColorTargets;++c)this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.colorAttachments[c],this.gl.TEXTURE_2D,this.colorTextures[c].texture,0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},PicoGL.Framebuffer.prototype.resize=function(a,b){a&&b?(this.width=a,this.height=b):(this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer);for(var c=0;c<this.numColorTargets;++c)this.colorTextures[c].image(null,this.width,this.height);this.depthTexture?this.depthTexture.image(null,this.width,this.height):(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.width,this.height),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null)),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}}(),function(){"use strict";PicoGL.DrawCall=function(a,b,c,d){this.gl=a,this.program=b||null,this.vertexArray=c||null,this.uniforms={},this.uniformBlocks={},this.uniformBlockBases={},this.uniformBlockCount=0,this.textures={},this.textureCount=0,this.indexArray=null,this.numItems=0,this.primitive=void 0!==d?d:PicoGL.TRIANGLES},PicoGL.DrawCall.prototype.indices=function(a){return this.indexArray=a,this.numItems=a.numItems,this},PicoGL.DrawCall.prototype.uniform=function(a,b){return this.uniforms[a]=b,this},PicoGL.DrawCall.prototype.texture=function(a,b){var c=this.uniforms[a];void 0===c&&(c=this.textureCount++,this.uniforms[a]=c);var d=this.gl["TEXTURE"+c];return this.textures[d]=b,this},PicoGL.DrawCall.prototype.uniformBlock=function(a,b){var c=this.uniformBlockBases[a];return void 0===c&&(c=this.uniformBlockCount++,this.uniformBlockBases[a]=c),this.uniformBlocks[c]=b,this},PicoGL.DrawCall.prototype.draw=function(a){var b=this.uniforms,c=this.uniformBlocks,d=this.uniformBlockBases,e=this.textures;a.program!==this.program&&(this.gl.useProgram(this.program.program),a.program=this.program);for(var f in b)this.program.uniform(f,b[f]);for(var g in d){var h=d[g];this.program.uniformBlock(g,h),c[h].bind(h)}for(var i in e)e[i].bind(i);a.vertexArray!==this.vertexArray&&(this.vertexArray.bind(),a.vertexArray=this.vertexArray),this.vertexArray.indexed?this.gl.drawElements(this.primitive,this.vertexArray.numElements,this.vertexArray.indexType,0):this.gl.drawArrays(this.primitive,0,this.vertexArray.numElements)}}();